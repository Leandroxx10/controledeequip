<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Sistema de Gerenciamento de Equipamentos - V 1.0.1</title>
  
  <!-- ===== BIBLIOTECAS EXTERNAS ===== -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  
  <style>
    /* ===== SISTEMA DE VARIÁVEIS CSS PARA TEMA CLARO/ESCURO ===== */
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #2ecc71;
      --accent: #e74c3c;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --gray: #7f8c8d;
      --radius: 12px;
      --shadow: 0 6px 18px rgba(0,0,0,0.08);
      
      /* Variáveis para modo claro (padrão) */
      --bg-primary: #f5f7fa;
      --bg-secondary: #c3cfe2;
      --card-bg: #fff;
      --text-primary: #2c3e50;
      --text-secondary: #7f8c8d;
      --border-color: #ddd;
    }
    
    /* ===== VARIÁVEIS PARA MODO ESCURO ===== */
    .dark-mode {
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --card-bg: #2d2d2d;
      --text-primary: #ffffff;
      --text-secondary: #b0b0b0;
      --border-color: #444;
      --primary: #1a2530;
      --light: #2d2d2d;
      --dark: #f5f5f5;
      --gray: #a0a0a0;
      --shadow: 0 6px 18px rgba(0,0,0,0.3);
    }
    
    /* ===== ESTILOS GLOBAIS DE RESET E BASE ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', sans-serif;
    }
    
    /* ===== ESTILOS DO CORPO DA PÁGINA ===== */
    body {
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 20px;
      transition: background 0.3s ease, color 0.3s ease;
    }
    
    /* ===== CONTAINER PRINCIPAL ===== */
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* ===== CABEÇALHO DO SISTEMA ===== */
    header {
      background: linear-gradient(135deg, var(--primary), #1a2530);
      color: #fff;
      padding: 18px;
      border-radius: 12px;
      text-align: center;
      box-shadow: var(--shadow);
      margin-bottom: 18px;
    }
    
    h1 {
      font-size: 1.6rem;
    }
    
    /* ===== CONTROLES SUPERIORES (TEMA, ORDENAÇÃO, IDIOMA) ===== */
    .top-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    
    .lang-select, .sort-select {
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      background: var(--card-bg);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }
    
    .theme-toggle {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    /* ===== PAINEL DE ESTATÍSTICAS (DASHBOARD) ===== */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-bottom: 18px;
    }
    
    .dashboard-card {
      background: var(--card-bg);
      padding: 14px;
      border-radius: 10px;
      text-align: center;
      box-shadow: var(--shadow);
      color: var(--text-primary);
    }
    
    /* ===== ÁREA DE PESQUISA ===== */
    .search-container {
      background: var(--card-bg);
      padding: 14px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      margin-bottom: 18px;
    }
    
    .search-box {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .search-input {
      flex: 1;
      padding: 10px;
      border-radius: 50px;
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      color: var(--text-primary);
    }
    
    /* ===== BOTÕES PRINCIPAIS DO SISTEMA ===== */
    .add-button, .search-button, .defects-button, .voice-search-button {
      padding: 10px 14px;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .add-button {
      background: var(--success);
      color: #fff;
    }
    
    .search-button {
      background: linear-gradient(135deg, var(--secondary), #2980b9);
      color: #fff;
    }
    
    .defects-button {
      background: linear-gradient(135deg, #4077ff, #6ab6ff);
      color: #fff;
    }
    
    .voice-search-button {
      background: linear-gradient(135deg, #2b82ff, #6ab6ff);
      color: #fff;
    }
    
    /* ===== ESTADO ATIVO PARA BOTÃO DE VOZ ===== */
    .voice-search-button.listening {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      animation: pulse 1.5s infinite;
    }
    
    /* ===== ANIMAÇÃO DE PULSO PARA INDICAR GRAVAÇÃO ===== */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    /* ===== FILTROS DE EQUIPAMENTOS ===== */
    .filters {
      display: flex;
      gap: 8px;
      margin: 12px 0;
      flex-wrap: wrap;
    }
    
    .filter-button {
      padding: 8px 14px;
      border-radius: 50px;
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      cursor: pointer;
      transition: all 0.3s ease;
      color: var(--text-primary);
    }
    
    .filter-button.active {
      background: var(--secondary);
      color: #fff;
      border-color: var(--secondary);
    }
    
    /* ===== GRADE DE CARDS DE EQUIPAMENTOS ===== */
    .equipment-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 18px;
    }
    
    .equipment-card {
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
      overflow: hidden;
      padding: 12px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    /* ===== EFEITO HOVER NOS CARDS ===== */
    .equipment-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    }
    
    /* ===== ESTILO PARA CARD DESTACADO (BUSCA POR VOZ) ===== */
    .equipment-card.highlighted {
      border: 3px solid #e74c3c;
      box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
      animation: highlightPulse 2s infinite;
    }
    
    /* ===== ANIMAÇÃO DE DESTAQUE ===== */
    @keyframes highlightPulse {
      0% { border-color: #e74c3c; }
      50% { border-color: #f39c12; }
      100% { border-color: #e74c3c; }
    }
    
    /* ===== COLUNA DE IMAGENS DOS EQUIPAMENTOS ===== */
    .images-col {
      width: 160px;
      flex-shrink: 0;
    }
    
    .equipment-image {
      width: 140px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      flex-shrink: 0;
      background: var(--light);
      display: block;
      margin-bottom: 6px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .equipment-image:hover {
      transform: scale(1.05);
    }
    
    /* ===== ÁREA DE INFORMAÇÕES DO EQUIPAMENTO ===== */
    .equipment-info {
      flex: 1;
    }
    
    .equipment-prefix {
      font-weight: 700;
      color: var(--secondary);
      margin-bottom: 6px;
    }
    
    .equipment-sub {
      color: var(--text-secondary);
      font-size: 0.95rem;
      margin-bottom: 6px;
    }
    
    .equipment-details {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 6px;
    }
    
    /* ===== BOTÕES DE AÇÃO EM CADA CARD ===== */
    .equipment-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    
    .edit-button, .copy-button, .delete-button, .view-button {
      flex: 1;
      color: #fff;
      border: none;
      padding: 8px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .edit-button {
      background: linear-gradient(135deg, var(--secondary), #2980b9);
    }
    
    .copy-button {
      background: linear-gradient(135deg, #16a085, #1abc9c);
    }
    
    .delete-button {
      background: linear-gradient(135deg, var(--accent), #c0392b);
    }
    
    .view-button {
      background: linear-gradient(135deg, #1e3a5f, #2c5282);
      width: 100%;
      margin-top: 8px;
    }
    
    /* ===== EFEITOS HOVER NOS BOTÕES ===== */
    .edit-button:hover, .copy-button:hover, .delete-button:hover, .view-button:hover {
      filter: brightness(1.1);
      transform: translateY(-2px);
    }
    
    /* ===== CONTROLES DE PAGINAÇÃO ===== */
    .pagination-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    
    .pagination-button {
      padding: 8px 12px;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-primary);
      transition: all 0.3s ease;
    }
    
    .pagination-button:hover:not(:disabled) {
      background: var(--secondary);
      color: white;
    }
    
    .pagination-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .pagination-info {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    /* ===== ESTILOS PARA MODAIS ===== */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }
    
    .modal.show {
      display: flex;
    }
    
    .modal-content {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 16px;
      max-width: 980px;
      width: 100%;
      max-height: 90vh;
      overflow: auto;
      box-shadow: 0 12px 36px rgba(0,0,0,.18);
      color: var(--text-primary);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .close-button {
      background: none;
      border: none;
      font-size: 22px;
      cursor: pointer;
      color: var(--text-secondary);
      transition: color 0.3s ease;
    }
    
    .close-button:hover {
      color: var(--accent);
    }
    
    /* ===== ESTILOS PARA FORMULÁRIOS ===== */
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .form-group {
      margin-bottom: 6px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.95rem;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      background: var(--card-bg);
      color: var(--text-primary);
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
      outline: none;
    }
    
    .form-textarea {
      min-height: 90px;
      resize: vertical;
    }
    
    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 8px;
    }
    
    .cancel-button, .save-button {
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .cancel-button {
      background: #7f8c8d;
      color: #fff;
    }
    
    .save-button {
      background: linear-gradient(135deg, var(--success), #27ae60);
      color: #fff;
    }
    
    .cancel-button:hover, .save-button:hover {
      filter: brightness(1.1);
      transform: translateY(-2px);
    }
    
    /* ===== SISTEMA DE NOTIFICAÇÕES ===== */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 18px;
      border-radius: 8px;
      color: #fff;
      display: none;
      z-index: 3000;
      box-shadow: var(--shadow);
    }
    
    .notification.show {
      display: block;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .notification.success {
      background: var(--success);
    }
    
    .notification.error {
      background: var(--accent);
    }
    
    .config-note {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    /* ===== SISTEMA DE ABAS ===== */
    .tabs {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .tab-button {
      flex: 1;
      padding: 12px;
      background: var(--light);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      color: var(--text-primary);
    }
    
    .tab-button.active {
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: #fff;
      transform: translateY(-2px);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* ===== ESTILOS PARA A ABA DE VÍDEOS ===== */
    .video-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
      gap: 20px;
    }
    
    .video-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .video-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    }
    
    .video-card h3 {
      margin-bottom: 8px;
      font-size: 1.2rem;
      color: #3498db;
    }
    
    .video-card iframe {
      width: 100%;
      height: 220px;
      border: none;
      border-radius: 12px;
      margin-bottom: 8px;
    }
    
    .video-card p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    .video-search {
      margin-bottom: 16px;
      display: flex;
      gap: 8px;
    }
    
    .video-search input {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      color: var(--text-primary);
    }
    
    .video-add {
      margin-top: 20px;
      padding: 16px;
      background: var(--light);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .video-add label {
      font-weight: 600;
      color: var(--text-primary);
      display: block;
      margin-top: 8px;
    }
    
    .video-add input, .video-add textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      margin-top: 4px;
      background: var(--card-bg);
      color: var(--text-primary);
    }
    
    .video-add button {
      margin-top: 12px;
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .video-add button:hover {
      filter: brightness(1.1);
      transform: translateY(-2px);
    }
    
    /* ===== ESTILOS PARA PLAYER DE VÍDEO ===== */
    .video-iframe {
      position: relative;
      width: 100%;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
    }
    
    .video-iframe video {
      width: 100%;
      height: auto;
      max-height: 480px;
      display: block;
      border-radius: 12px;
      background: #000;
    }
    
    /* ===== BOTÕES DE AÇÃO PARA VÍDEOS ===== */
    .video-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    
    .video-actions button {
      background: var(--light);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 6px 12px;
      margin: 2px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s ease-in-out;
      color: var(--text-primary);
    }
    
    .video-actions button:hover {
      background: var(--border-color);
      border-color: var(--text-secondary);
    }
    
    .video-actions .edit-btn {
      color: #1565c0;
    }
    
    .video-actions .delete-btn {
      color: #c62828;
    }
    
    /* ===== MODAL DE VISUALIZAÇÃO DE IMAGEM ===== */
    .image-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.8);
      align-items: center;
      justify-content: center;
      z-index: 3000;
    }
    
    .image-modal.show {
      display: flex;
    }
    
    .image-modal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,.5);
    }
    
    /* ===== INDICADOR DE BUSCA POR VOZ ===== */
    .voice-indicator {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 20px;
      border-radius: 12px;
      z-index: 4000;
      text-align: center;
      box-shadow: 0 0 30px rgba(231, 76, 60, 0.5);
    }
    
    .voice-indicator.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    .voice-indicator i {
      font-size: 48px;
      margin-bottom: 10px;
      color: #e74c3c;
      animation: pulse 1.5s infinite;
    }
    
    /* ===== ESTILOS PARA A BUSCA INTELIGENTE COM IA ===== */
    .ai-search-container {
      background: var(--card-bg);
      padding: 14px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      margin-bottom: 18px;
      border-left: 4px solid #3498db;
    }
    
    .ai-search-title {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ai-search-title i {
      color: #3498db;
    }
    
    .ai-search-description {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 12px;
    }
    
    .ai-search-examples {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    
    .ai-search-example {
      background: var(--light);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 0.85rem;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .ai-search-example:hover {
      background: var(--border-color);
      transform: translateY(-2px);
    }
    
    /* ===== ESTILOS PARA CARTA DE CONTATO ===== */
    .contact-card {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
    }
    
    .contact-photo {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0 auto 15px;
      display: block;
      border: 4px solid #3498db;
    }
    
    .contact-info {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .contact-name {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 5px;
    }
    
    .contact-role {
      color: var(--text-secondary);
      font-size: 1rem;
    }
    
    .contact-details {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .contact-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: var(--light);
      border-radius: 8px;
    }
    
    .contact-item i {
      width: 20px;
      color: #3498db;
    }
    
    .contact-text {
      flex: 1;
    }
    
    .contact-label {
      font-weight: 600;
      color: var(--text-primary);
      display: block;
      margin-bottom: 2px;
    }
    
    .contact-value {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    .copy-btn {
      background: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .copy-btn:hover {
      background: #2980b9;
      transform: translateY(-2px);
    }
    
    .contact-note {
      margin-top: 20px;
      padding: 15px;
      background: #e8f4fd;
      border-radius: 8px;
      border-left: 4px solid #3498db;
      font-size: 0.9rem;
      color: var(--text-primary);
    }
    
    /* ===== ESTILOS PARA LOADING ===== */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ===== ESTILOS PARA PREVIEW DE IMAGENS ===== */
    .image-preview {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .image-preview img {
      width: 100px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    /* ===== MELHORIAS PARA DISPOSITIVOS MÓVEIS ===== */
    @media (max-width: 920px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .dashboard {
        grid-template-columns: 1fr;
      }
      
      .equipment-grid {
        grid-template-columns: 1fr;
      }
      
      .search-box {
        flex-wrap: wrap;
      }
      
      .voice-search-button, .search-button {
        flex: 1;
      }
      
      /* MELHORIAS ESPECÍFICAS PARA CARDS EM CELULAR */
      .equipment-card {
        flex-direction: column;
        padding: 15px;
      }
      
      .images-col {
        width: 100%;
        display: flex;
        justify-content: space-around;
        margin-bottom: 10px;
      }
      
      .equipment-image {
        width: 48%;
        height: 120px;
      }
      
      .equipment-info {
        width: 100%;
      }
      
      /* Ajuste para o modal de detalhes do equipamento em mobile */
      .modal-content {
        margin: 10px;
        padding: 15px;
        max-height: calc(100vh - 20px);
        overflow-y: auto;
      }
      
      /* Ajuste para a grade de detalhes do equipamento em mobile */
      #equipmentDetailContent .detail-grid {
        grid-template-columns: 1fr;
      }
    }
    
    /* ===== ESTILOS ESPECÍFICOS PARA DETALHES DO EQUIPAMENTO ===== */
    .detail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .detail-group {
      background: var(--light);
      padding: 12px;
      border-radius: 8px;
    }
    
    .detail-label {
      font-weight: 600;
      color: var(--text-primary);
      display: block;
      margin-bottom: 5px;
      font-size: 0.9rem;
    }
    
    .detail-value {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    .detail-full-width {
      grid-column: 1 / -1;
    }
    
    .detail-section-title {
      grid-column: 1 / -1;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-top: 15px;
      margin-bottom: 10px;
      padding-bottom: 5px;
      border-bottom: 2px solid #3498db;
    }
    
    /* ===== ESTILOS PARA OS CAMPOS DIMENSIONAIS ===== */
    .dimensional-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
    }
    
    .dimensional-group {
      display: flex;
      flex-direction: column;
    }
    
    .dimensional-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-bottom: 4px;
      text-align: center;
    }
    
    .dimensional-input {
      text-align: center;
    }
    
    /* ===== ESTILOS PARA ATALHOS DE TECLADO ===== */
.shortcut-hint {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--card-bg);
    border: 2px solid var(--secondary);
    border-radius: 8px;
    padding: 10px;
    font-size: 0.8rem;
    color: var(--text-primary);
    box-shadow: var(--shadow);
    z-index: 1000;
    display: none;
}

.shortcut-hint.show {
    display: block;
    animation: fadeIn 0.3s ease;
}

.shortcut-key {
    display: inline-block;
    background: var(--primary);
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
    margin: 0 2px;
    font-size: 0.7rem;
}
    
  </style>
</head>

<body>
  <!-- ===== CONTAINER PRINCIPAL DA APLICAÇÃO ===== -->
  <div class="container">
    <!-- CABEÇALHO DO SISTEMA COM LOGO E TÍTULO -->
    <header>
      <div style="display:flex;align-items:center;gap:12px;justify-content:center;">
        <div style="width:100px;height:70px;border-radius:6px;overflow:hidden;display:flex;align-items:center;justify-content:center;">
          <img src="https://raw.githubusercontent.com/Leandroxx10/controledeequip/refs/heads/main/file_00000000fbb46230a8c8a01e0f8354e6.png" 
               alt="Logo" 
               style="max-width:100%;max-height:100%;object-fit:contain;">
        </div>
        <h1><i class="fas fa-tools"></i> <span id="appTitle">Gerenciador de Equipamentos Completo</span></h1>
      </div>
      <p style="opacity:.9" class="config-note">Conectado ao Firestore: <strong>sistema de equipamentos</strong>.</p>
    </header>

    <!-- CONTROLES SUPERIORES (TEMA, ORDENAÇÃO, IDIOMA) -->
    <div class="top-controls">
      <div class="config-note" style="margin-right:8px;">Conectado ao Firestore: <strong>sistema de equipamentos</strong></div>
      <div style="flex:1"></div>
      
      <!-- Botão para alternar modo escuro/claro -->
      <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i> <span id="themeText">Modo Escuro</span>
      </button>
      
      <!-- Seletor de ordenação dos equipamentos -->
      <select id="sortSelect" class="sort-select" aria-label="Ordenar equipamentos">
        <option value="prefix-asc">Prefixo (A-Z)</option>
        <option value="prefix-desc">Prefixo (Z-A)</option>
        <option value="date-newest">Mais Recentes</option>
        <option value="date-oldest">Mais Antigos</option>
      </select>
      
      <!-- Seletor de idioma da interface -->
      <select id="langToggle" class="lang-select" aria-label="Selecionar idioma">
        <option value="pt">Português</option>
        <option value="en">English</option>
        <option value="it">Italiano</option>
        <option value="zh">中文</option>
        <option value="ja">日本語</option>
      </select>
    </div>

    <!-- PAINEL DE ESTATÍSTICAS DO SISTEMA -->
    <div class="dashboard">
      <div class="dashboard-card">
        <div style="font-size:22px;font-weight:700" id="totalEquipment">0</div>
        <div style="color:var(--text-secondary)"><span id="totalEquipmentLabel">Total de Equipamentos</span></div>
      </div>
      <div class="dashboard-card">
        <div style="font-size:22px;font-weight:700" id="totalProduction">0</div>
        <div style="color:var(--text-secondary)"><span id="totalProductionLabel">Em Produção</span></div>
      </div>
      <div class="dashboard-card">
        <div style="font-size:22px;font-weight:700" id="totalOut">0</div>
        <div style="color:var(--text-secondary)"><span id="totalOutLabel">Fora de Produção</span></div>
      </div>
    </div>

    <!-- ABA DE NAVEGAÇÃO PRINCIPAL -->
    <div class="tabs">
      <button class="tab-button active" id="tabEquip">Equipamentos</button>
      <button class="tab-button" id="tabVideos">Video Aulas</button>
      <button class="tab-button" id="tabContato">Contato</button>
    </div>

    <!-- CONTEÚDO DA ABA DE EQUIPAMENTOS -->
    <div id="tabContentEquip" class="tab-content active">
      <div class="search-container">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <h2 style="margin:0" id="listTitle">Lista de Equipamentos</h2>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="add-button" id="addButton"><i class="fas fa-plus"></i> <span id="addBtnText">Novo Equipamento</span></button>
            <button class="defects-button" id="defectsButton"><i class="fas fa-exclamation-triangle"></i> <span id="defectsBtnText">Defeitos</span></button>
          </div>
        </div>

        <!-- BUSCA INTELIGENTE COM IA E RECONHECIMENTO DE VOZ -->
        <div class="ai-search-container">
          <div class="ai-search-title">
            <i class="fas fa-robot"></i>
            <span>Busca por Voz - Procure por Prefixos</span>
          </div>
          <div class="ai-search-description">
            Clique no microfone e fale o prefixo do equipamento (ex: "LB-545") para ver suas informações. Diga "fechar informação" para fechar.
          </div>
          <div class="search-box">
            <input id="aiSearchInput" class="search-input" placeholder="Ou digite o prefixo do equipamento..." />
            <button id="aiSearchButton" class="search-button"><i class="fas fa-search"></i> Buscar</button>
            <button id="voiceSearchButton" class="voice-search-button" title="Busca por voz"><i class="fas fa-microphone"></i> Voz</button>
          </div>
        </div>

        <!-- FILTROS RÁPIDOS PARA EQUIPAMENTOS -->
        <div class="filters" id="filters">
          <button class="filter-button active" data-filter="all"><span id="filterAll">Todos</span></button>
          <button class="filter-button" data-filter="production"><span id="filterProduction">Em Produção</span></button>
          <button class="filter-button" data-filter="out"><span id="filterOut">Fora de Produção</span></button>
        </div>

        <!-- BUSCA TRADICIONAL POR TEXTO -->
        <div class="search-box" style="margin-top:8px">
          <input id="searchInput" class="search-input" placeholder="Buscar por prefixo (Molde / Blank)..." />
          <button id="searchButton" class="search-button"><i class="fas fa-search"></i> <span id="searchBtnText">Procurar</span></button>
        </div>
      </div>

      <!-- GRADE DE EQUIPAMENTOS (CARDS) -->
      <div id="equipmentGrid" class="equipment-grid"></div>
      
      <!-- CONTROLES DE PAGINAÇÃO -->
      <div class="pagination-controls" id="paginationControls" style="display: none;">
        <button class="pagination-button" id="prevPage" disabled>
          <i class="fas fa-chevron-left"></i> Anterior
        </button>
        <span class="pagination-info" id="pageInfo">Página 1 de 1</span>
        <button class="pagination-button" id="nextPage" disabled>
          Próxima <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
    
    <!-- CONTEÚDO DA ABA DE VÍDEOS -->
    <div id="tabContentVideos" class="tab-content">
      <h2 style="display:flex;justify-content:space-between;align-items:center;">
        <span><i class="fas fa-video"></i> Video Aulas</span>
        <span style="font-size:0.9rem;color:#555;">Total: <span id="totalVideos">0</span></span>
      </h2>
      
      <!-- BARRA DE BUSCA PARA VÍDEOS -->
      <div class="video-search">
        <input type="text" id="videoSearch" placeholder="Buscar vídeos por título ou descrição...">
      </div>
      
      <!-- GRADE DE VÍDEOS -->
      <div id="videoGrid" class="video-list"></div>

      <!-- FORMULÁRIO PARA ADICIONAR NOVOS VÍDEOS -->
      <div class="video-add">
        <h3>Adicionar Novo Vídeo</h3>
        <label for="videoTitulo">Título</label>
        <input id="videoTitulo" required>
        <label for="videoDescricao">Descrição</label>
        <textarea id="videoDescricao"></textarea>
        <label for="videoUrl">URL do Vídeo (YouTube, Vimeo, ou arquivo MP4 do GitHub)</label>
        <input id="videoUrl" placeholder="https://www.youtube.com/embed/XXXX ou https://raw.githubusercontent.com/.../video.mp4">
        <label for="videoThumbnail">Thumbnail (URL da Imagem - opcional)</label>
        <input id="videoThumbnail" placeholder="https://.../thumb.jpg">
        <button id="addVideoBtn"><i class="fas fa-save"></i> Salvar Vídeo</button>
      </div>
    </div>

    <!-- CONTEÚDO DA ABA DE CONTATO -->
    <div id="tabContentContato" class="tab-content">
      <div class="contact-card">
        <img src="https://raw.githubusercontent.com/Leandroxx10/controledeequip/refs/heads/main/gemini-2.5-flash-image-preview%20(nano-banana)_Headshot_de_um_model%20(28).png" alt="Foto de Leandro" class="contact-photo" id="contactPhoto">
        <div class="contact-info">
          <div class="contact-name">Leandro</div>
          <div class="contact-role">Desenvolvedor & Suporte Técnico</div>
        </div>
        
        <div class="contact-details">
          <div class="contact-item">
            <i class="fas fa-phone"></i>
            <div class="contact-text">
              <span class="contact-label">Telefone</span>
              <span class="contact-value">+55 11 96329-0107</span>
            </div>
            <button class="copy-btn" data-text="+5511963290107">
              <i class="fas fa-copy"></i>
            </button>
          </div>
          
          <div class="contact-item">
            <i class="fas fa-envelope"></i>
            <div class="contact-text">
              <span class="contact-label">E-mail</span>
              <span class="contact-value">Leandrodevxx@gmail.com</span>
            </div>
            <button class="copy-btn" data-text="Leandrodevxx@gmail.com">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
        
        <div class="contact-note">
          <i class="fas fa-info-circle"></i>
          Entre em contato para suporte técnico, dúvidas ou solicitações de melhorias no sistema.
        </div>
      </div>
    </div>

    <!-- RODAPÉ DO SISTEMA -->
    <footer style="text-align:center;margin-top:18px;color:var(--text-secondary)">
      Sistema de Gerenciamento de Equipamentos — Versão 1.0.1
    </footer>
  </div>

  <!-- ===== MODAL PARA ADICIONAR EQUIPAMENTO ===== -->
  <div class="modal" id="addModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h3 id="addModalTitle"><i class="fas fa-plus"></i> <span id="addModalTitleText">Novo Equipamento</span></h3>
        <button class="close-button" data-close="addModal">&times;</button>
      </div>
      <form id="addForm">
        <!-- PRIMEIRA LINHA DO FORMULÁRIO: PREFIXO MOLDE E ALMOXARIFADO -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addPrefixoMolde">Prefixo Molde</label>
            <input id="addPrefixoMolde" class="form-input" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="addMoldeAlmox">Molde Almoxarifado</label>
            <select id="addMoldeAlmox" class="form-select">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="20+">20+</option>
            </select>
          </div>
        </div>

        <!-- SEGUNDA LINHA: PREFIXO BLANK E ALMOXARIFADO -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addPrefixoBlank">Prefixo Blank</label>
            <input id="addPrefixoBlank" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="addBlankAlmox">Blank Almoxarifado</label>
            <select id="addBlankAlmox" class="form-select">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="20+">20+</option>
            </select>
          </div>
        </div>

        <!-- TERCEIRA LINHA: PROCESSO E CLASSE -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addProcesso">Processo</label>
            <select id="addProcesso" class="form-select" required>
              <option value="SG">SG</option><option value="DG">DG</option><option value="TG">TG</option><option value="QG">QG</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="addClasse">Classe</label>
            <select id="addClasse" class="form-select">
              <option>Classe A</option><option>Classe B</option><option>Classe C</option>
            </select>
          </div>
        </div>

        <!-- COMPONENTES DO EQUIPAMENTO - PRIMEIRA PARTE -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addNeckrings">Neckrings</label>
            <input id="addNeckrings" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="addAneisGuias">Aneis Guias</label>
            <input id="addAneisGuias" class="form-input" />
          </div>
        </div>

        <!-- COMPONENTES DO EQUIPAMENTO - SEGUNDA PARTE -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addThimble">Thimbles</label>
            <input id="addThimble" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="addMachos">Machos</label>
            <input id="addMachos" class="form-input" />
          </div>
        </div>

        <!-- COMPONENTES DO EQUIPAMENTO - TERCEIRA PARTE -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addCoolers">Coolers</label>
            <input id="addCoolers" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="addBaffles">Baffles</label>
            <input id="addBaffles" class="form-input" />
          </div>
        </div>

        <!-- COMPONENTES DO EQUIPAMENTO - QUARTA PARTE -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addBafflesPlugs">Baffles Plugs</label>
            <input id="addBafflesPlugs" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="addFunis">Funis</label>
            <input id="addFunis" class="form-input" />
          </div>
        </div>

        <!-- COMPONENTES DO EQUIPAMENTO - QUINTA PARTE -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addFundos">Fundos</label>
            <input id="addFundos" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="addFundosPlugs">Fundos Plugs</label>
            <input id="addFundosPlugs" class="form-input" />
          </div>
        </div>

        <!-- COMPONENTES DO EQUIPAMENTO - SEXTA PARTE -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addSopradores">Sopradores</label>
            <input id="addSopradores" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="addPincas">Pinças</label>
            <input id="addPincas" class="form-input" />
          </div>
        </div>

        <!-- LOCALIZAÇÃO NO ALMOXARIFADO -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addCorredor">Corredor</label>
            <select id="addCorredor" class="form-select">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="addPrateleira">Prateleira</label>
            <input id="addPrateleira" class="form-input" />
          </div>
        </div>

        <!-- OBSERVAÇÕES GERAIS -->
        <div class="form-row">
          <div class="form-group" style="grid-column:1/-1">
            <label class="form-label" for="addObservacoesTopo">Observações</label>
            <input id="addObservacoesTopo" class="form-input" />
          </div>
        </div>

        <!-- TIPO DE POLIMENTO -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addPolimentoMolde">Tipo de Polimento Molde</label>
            <select id="addPolimentoMolde" class="form-select">
              <option>Na madeira</option><option>Na máquina</option><option>Na politriz</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="addPolimentoBlank">Tipo de Polimento Blank</label>
            <select id="addPolimentoBlank" class="form-select">
              <option>Na madeira</option><option>Na máquina</option><option>Na politriz</option><option>Sem Polimento</option>
            </select>
          </div>
        </div>

<!-- ===== SEÇÃO DE GRAFITE ===== -->
<div class="form-row">
  <div class="form-group" style="grid-column:1/-1">
    <div class="detail-section-title" style="margin-top:0;padding-top:0">Grafite</div>
  </div>
</div>

<div class="form-row">
  <div class="form-group">
    <label class="form-label" for="addGrafiteMolde">Molde</label>
    <select id="addGrafiteMolde" class="form-select">
      <option value="">Selecione...</option>
      <option value="Grafite com Cura">Grafite com Cura</option>
      <option value="Grafite sem Cura">Grafite sem Cura</option>
    </select>
  </div>
  <div class="form-group">
    <label class="form-label" for="addGrafiteBlank">Blank</label>
    <select id="addGrafiteBlank" class="form-select">
      <option value="">Selecione...</option>
      <option value="Grafite com Cura">Grafite com Cura</option>
      <option value="Grafite sem Cura">Grafite sem Cura</option>
    </select>
  </div>
</div>

<div class="form-row">
  <div class="form-group">
    <label class="form-label" for="addGrafiteFundo">Fundo</label>
    <select id="addGrafiteFundo" class="form-select">
      <option value="">Selecione...</option>
      <option value="Grafite com Cura">Grafite com Cura</option>
      <option value="Grafite sem Cura">Grafite sem Cura</option>
    </select>
  </div>
  <div class="form-group">
    <label class="form-label" for="addGrafiteFunil">Funil</label>
    <select id="addGrafiteFunil" class="form-select">
      <option value="">Selecione...</option>
      <option value="Grafite com Cura">Grafite com Cura</option>
      <option value="Grafite sem Cura">Grafite sem Cura</option>
    </select>
  </div>
</div>
        <!-- OBSERVAÇÕES TÉCNICAS -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addObservacaoAjustagem">Observações Ajustagem</label>
            <input id="addObservacaoAjustagem" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="addCausasTroca">Observações / Causas de Troca</label>
            <input id="addCausasTroca" class="form-input" />
          </div>
        </div>

        <!-- CAMPOS DIMENSIONAIS DO GARGALO E CORPO -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Dimensional do Gargalo (mm)</label>
            <div class="dimensional-row">
              <div class="dimensional-group">
                <span class="dimensional-label">Tolerância -</span>
                <input id="addDiametroGargaloMenos" type="number" class="form-input dimensional-input" />
              </div>
              <div class="dimensional-group">
                <span class="dimensional-label">Ideal</span>
                <input id="addDiametroGargaloIdeal" type="number" class="form-input dimensional-input" />
              </div>
              <div class="dimensional-group">
                <span class="dimensional-label">Tolerância +</span>
                <input id="addDiametroGargaloMais" type="number" class="form-input dimensional-input" />
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Dimensional do Corpo (mm)</label>
            <div class="dimensional-row">
              <div class="dimensional-group">
                <span class="dimensional-label">Tolerância -</span>
                <input id="addDiametroCorpoMenos" type="number" class="form-input dimensional-input" />
              </div>
              <div class="dimensional-group">
                <span class="dimensional-label">Ideal</span>
                <input id="addDiametroCorpoIdeal" type="number" class="form-input dimensional-input" />
              </div>
              <div class="dimensional-group">
                <span class="dimensional-label">Tolerância +</span>
                <input id="addDiametroCorpoMais" type="number" class="form-input dimensional-input" />
              </div>
            </div>
          </div>
        </div>

        <!-- OBSERVAÇÕES ADICIONAIS E STATUS -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="addObservacoesAdicionais">Observações Adicionais</label>
            <input id="addObservacoesAdicionais" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="addStatus">Status</label>
            <select id="addStatus" class="form-select">
              <option value="production">Em produção</option>
              <option value="out">Fora de produção</option>
              <option value="sample">Amostra</option>
            </select>
          </div>
        </div>

        <!-- URLS DAS IMAGENS -->
<div class="form-row">
  <div class="form-group">
    <label class="form-label" for="addUrlImg1">URL da imagem 1</label>
    <input id="addUrlImg1" class="form-input" placeholder="https://..." />
  </div>
  <div class="form-group">
    <label class="form-label" for="addUrlImg2">URL da imagem 2</label>
    <input id="addUrlImg2" class="form-input" placeholder="https://..." />
  </div>
</div>

<!-- LINKS DAS IMAGENS (NOVO) -->
<div class="form-row">
  <div class="form-group">
    <label class="form-label" for="addLinkImg1">Link da imagem 1 (opcional)</label>
    <input id="addLinkImg1" class="form-input" placeholder="https://... (link que abre ao clicar na imagem)" />
  </div>
  <div class="form-group">
    <label class="form-label" for="addLinkImg2">Link da imagem 2 (opcional)</label>
    <input id="addLinkImg2" class="form-input" placeholder="https://... (link que abre ao clicar na imagem)" />
  </div>
</div>

<!-- PREVIEW DAS IMAGENS -->
<div class="image-preview" id="imagePreview">
  <!-- Preview das imagens será inserido aqui dinamicamente -->
</div>
        <!-- BOTÕES DE AÇÃO DO FORMULÁRIO -->
        <div class="form-actions">
          <button type="button" class="cancel-button" data-close="addModal"><span id="cancelBtnText">Cancelar</span></button>
          <button type="submit" class="save-button"><span id="saveBtnText">Salvar</span></button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== MODAL PARA EDITAR EQUIPAMENTO ===== -->
  <div class="modal" id="editModal" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="editModalTitle"><i class="fas fa-edit"></i> <span id="editModalTitleText">Editar Equipamento</span></h3>
        <button class="close-button" data-close="editModal">&times;</button>
      </div>
      <form id="editForm">
        <input type="hidden" id="editId" />
        
        <!-- ESTRUTURA IDÊNTICA AO FORMULÁRIO DE ADIÇÃO, MAS COM IDs EDIT* -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editPrefixoMolde">Prefixo Molde</label>
            <input id="editPrefixoMolde" class="form-input" required />
          </div>
          <div class="form-group">
            <label class="form-label" for="editMoldeAlmox">Molde Almoxarifado</label>
            <select id="editMoldeAlmox" class="form-select">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="20+">20+</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editPrefixoBlank">Prefixo Blank</label>
            <input id="editPrefixoBlank" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="editBlankAlmox">Blank Almoxarifado</label>
            <select id="editBlankAlmox" class="form-select">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="20+">20+</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editProcesso">Processo</label>
            <select id="editProcesso" class="form-select" required>
              <option value="SG">SG</option><option value="DG">DG</option><option value="TG">TG</option><option value="QG">QG</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="editClasse">Classe</label>
            <select id="editClasse" class="form-select">
              <option>Classe A</option><option>Classe B</option><option>Classe C</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editNeckrings">Neckrings</label>
            <input id="editNeckrings" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="editAneisGuias">Aneis Guias</label>
            <input id="editAneisGuias" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editThimble">Thimbles</label>
            <input id="editThimble" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="editMachos">Machos</label>
            <input id="editMachos" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editCoolers">Coolers</label>
            <input id="editCoolers" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="editBaffles">Baffles</label>
            <input id="editBaffles" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editBafflesPlugs">Baffles Plugs</label>
            <input id="editBafflesPlugs" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="editFunis">Funis</label>
            <input id="editFunis" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editFundos">Fundos</label>
            <input id="editFundos" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="editFundosPlugs">Fundos Plugs</label>
            <input id="editFundosPlugs" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editSopradores">Sopradores</label>
            <input id="editSopradores" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="editPincas">Pinças</label>
            <input id="editPincas" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editCorredor">Corredor</label>
            <select id="editCorredor" class="form-select">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="editPrateleira">Prateleira</label>
            <input id="editPrateleira" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group" style="grid-column:1/-1">
            <label class="form-label" for="editObservacoesTopo">Observações</label>
            <input id="editObservacoesTopo" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editPolimentoMolde">Tipo de Polimento Molde</label>
            <select id="editPolimentoMolde" class="form-select">
              <option>Na madeira</option><option>Na máquina</option><option>Na politriz</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="editPolimentoBlank">Tipo de Polimento Blank</label>
            <select id="editPolimentoBlank" class="form-select">
              <option>Na madeira</option><option>Na máquina</option><option>Na politriz</option><option>Sem Polimento</option>
            </select>
          </div>
        </div>

<!-- ===== SEÇÃO DE GRAFITE ===== -->
<div class="form-row">
  <div class="form-group" style="grid-column:1/-1">
    <div class="detail-section-title" style="margin-top:0;padding-top:0">Grafite</div>
  </div>
</div>

<div class="form-row">
  <div class="form-group">
    <label class="form-label" for="editGrafiteMolde">Molde</label>
    <select id="editGrafiteMolde" class="form-select">
      <option value="">Selecione...</option>
      <option value="Grafite com Cura">Grafite com Cura</option>
      <option value="Grafite sem Cura">Grafite sem Cura</option>
    </select>
  </div>
  <div class="form-group">
    <label class="form-label" for="editGrafiteBlank">Blank</label>
    <select id="editGrafiteBlank" class="form-select">
      <option value="">Selecione...</option>
      <option value="Grafite com Cura">Grafite com Cura</option>
      <option value="Grafite sem Cura">Grafite sem Cura</option>
    </select>
  </div>
</div>

<div class="form-row">
  <div class="form-group">
    <label class="form-label" for="editGrafiteFundo">Fundo</label>
    <select id="editGrafiteFundo" class="form-select">
      <option value="">Selecione...</option>
      <option value="Grafite com Cura">Grafite com Cura</option>
      <option value="Grafite sem Cura">Grafite sem Cura</option>
    </select>
  </div>
  <div class="form-group">
    <label class="form-label" for="editGrafiteFunil">Funil</label>
    <select id="editGrafiteFunil" class="form-select">
      <option value="">Selecione...</option>
      <option value="Grafite com Cura">Grafite com Cura</option>
      <option value="Grafite sem Cura">Grafite sem Cura</option>
    </select>
  </div>
</div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editObservacaoAjustagem">Observações Ajustagem</label>
            <input id="editObservacaoAjustagem" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="editCausasTroca">Observações / Causas de Troca</label>
            <input id="editCausasTroca" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Dimensional do Gargalo (mm)</label>
            <div class="dimensional-row">
              <div class="dimensional-group">
                <span class="dimensional-label">Tolerância -</span>
                <input id="editDiametroGargaloMenos" type="number" class="form-input dimensional-input" />
              </div>
              <div class="dimensional-group">
                <span class="dimensional-label">Ideal</span>
                <input id="editDiametroGargaloIdeal" type="number" class="form-input dimensional-input" />
              </div>
              <div class="dimensional-group">
                <span class="dimensional-label">Tolerância +</span>
                <input id="editDiametroGargaloMais" type="number" class="form-input dimensional-input" />
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Dimensional do Corpo (mm)</label>
            <div class="dimensional-row">
              <div class="dimensional-group">
                <span class="dimensional-label">Tolerância -</span>
                <input id="editDiametroCorpoMenos" type="number" class="form-input dimensional-input" />
              </div>
              <div class="dimensional-group">
                <span class="dimensional-label">Ideal</span>
                <input id="editDiametroCorpoIdeal" type="number" class="form-input dimensional-input" />
              </div>
              <div class="dimensional-group">
                <span class="dimensional-label">Tolerância +</span>
                <input id="editDiametroCorpoMais" type="number" class="form-input dimensional-input" />
              </div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="editObservacoesAdicionais">Observações Adicionais</label>
            <input id="editObservacoesAdicionais" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label" for="editStatus">Status</label>
            <select id="editStatus" class="form-select">
              <option value="production">Em produção</option>
              <option value="out">Fora de produção</option>
              <option value="sample">Amostra</option>
            </select>
          </div>
        </div>

        <div class="form-row">
  <div class="form-group">
    <label class="form-label" for="editUrlImg1">URL da imagem 1</label>
    <input id="editUrlImg1" class="form-input" placeholder="https://..." />
  </div>
  <div class="form-group">
    <label class="form-label" for="editUrlImg2">URL da imagem 2</label>
    <input id="editUrlImg2" class="form-input" placeholder="https://..." />
  </div>
</div>

<!-- LINKS DAS IMAGENS (NOVO) -->
<div class="form-row">
  <div class="form-group">
    <label class="form-label" for="editLinkImg1">Link da imagem 1 (opcional)</label>
    <input id="editLinkImg1" class="form-input" placeholder="https://... (link que abre ao clicar na imagem)" />
  </div>
  <div class="form-group">
    <label class="form-label" for="editLinkImg2">Link da imagem 2 (opcional)</label>
    <input id="editLinkImg2" class="form-input" placeholder="https://... (link que abre ao clicar na imagem)" />
  </div>
</div>

<!-- PREVIEW DAS IMAGENS -->
<div class="image-preview" id="editImagePreview">
  <!-- Preview das imagens será inserido aqui dinamicamente -->
</div>

        <div class="form-actions">
          <button type="button" class="cancel-button" data-close="editModal"><span id="cancelEditBtnText">Cancelar</span></button>
          <button type="submit" class="save-button"><span id="saveEditBtnText">Salvar Alterações</span></button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== MODAL PARA VISUALIZAÇÃO DETALHADA DO EQUIPAMENTO (Voz) ===== -->
  <div class="modal" id="equipmentDetailModal" aria-hidden="true">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h3><i class="fas fa-info-circle"></i> <span id="equipmentDetailTitle">Detalhes do Equipamento</span></h3>
        <button class="close-button" data-close="equipmentDetailModal">&times;</button>
      </div>
      <div id="equipmentDetailContent" style="padding: 20px;">
        <!-- Conteúdo será preenchido dinamicamente pelo JavaScript -->
      </div>
    </div>
  </div>

  <!-- ===== MODAL PARA VISUALIZAÇÃO DO EQUIPAMENTO (Botão Visualizar) ===== -->
  <div class="modal" id="viewModal" aria-hidden="true">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h3><i class="fas fa-eye"></i> Visualizar Equipamento</h3>
        <button class="close-button" data-close="viewModal">&times;</button>
      </div>
      <div id="viewModalContent" style="padding: 20px;">
        <!-- Conteúdo será preenchido dinamicamente pelo JavaScript -->
      </div>
    </div>
  </div>

  <!-- ===== MODAL PARA DEFEITOS ===== -->
<div class="modal" id="defectsModal" aria-hidden="true">
  <div class="modal-content" style="max-width: 700px; max-height: 85vh; display: flex; flex-direction: column;">
    <div class="modal-header">
      <h3><i class="fas fa-exclamation-triangle"></i> <span id="defectsModalTitle">Defeitos</span></h3>
      <button class="close-button" data-close="defectsModal">&times;</button>
    </div>
    <div style="flex: 1; overflow-y: auto; padding: 0 5px;">
      <div class="form-group">
        <label class="form-label" for="defectSelect">Selecione o defeito</label>
        <select id="defectSelect" class="form-select">
          <option value="">-- Selecione --</option>
          <option value="Costura de Molde">Costura de Molde</option>
          
          <option value="Costura de Blank">Costura de Blank</option>
          
          <option value="Frizo no Fundo">Frizo no Fundo</option>
          
          <option value="Marca de Baffle">Marca de Baffle</option>
          
          <option value="Racho na Terminação">Racho na Terminação</option>
          
          <option value="Racho na Trava">Racho na Trava</option>
          
          <option value="Dobra Aberta no Gargalo">Dobra Aberta no Gargalo</option>
          
          <option value="Negativo">Negativo</option>
          
          <option value="Equipamento fora de Centro">Equipamento fora de Centro</option>
        </select>
      </div>
      <div class="form-group" id="defectInfo" style="display:none">
        <label class="form-label">Informações</label>
        <textarea id="defectText" class="form-textarea" readonly style="min-height: 300px; resize: vertical;"></textarea>
      </div>
    </div>
  </div>
</div>


  <!-- ===== MODAL PARA EDITAR VÍDEO ===== -->
  <div class="modal" id="editVideoModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" style="max-width:600px">
      <div class="modal-header">
        <h3><i class="fas fa-edit"></i> Editar Vídeo</h3>
        <button class="close-button" data-close="editVideoModal">&times;</button>
      </div>
      <form id="editVideoForm">
        <input type="hidden" id="editVideoId" />
        <div class="form-group">
          <label class="form-label" for="editVideoTitulo">Título</label>
          <input id="editVideoTitulo" class="form-input" required />
        </div>
        <div class="form-group">
          <label class="form-label" for="editVideoDescricao">Descrição</label>
          <textarea id="editVideoDescricao" class="form-textarea"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label" for="editVideoUrl">URL do Vídeo (YouTube, Vimeo, ou arquivo MP4)</label>
          <input id="editVideoUrl" class="form-input" placeholder="https://www.youtube.com/embed/XXXX ou https://exemplo.com/video.mp4" />
        </div>
        <div class="form-group">
          <label class="form-label" for="editVideoThumbnail">Thumbnail (URL da Imagem - opcional)</label>
          <input id="editVideoThumbnail" class="form-input" placeholder="https://.../thumb.jpg" />
        </div>
        <div class="form-actions">
          <button type="button" class="cancel-button" data-close="editVideoModal">Cancelar</button>
          <button type="submit" class="save-button">Salvar Alterações</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== SISTEMA DE NOTIFICAÇÕES ===== -->
  <div id="notification" class="notification"></div>

  <!-- ===== INDICADOR DE BUSCA POR VOZ ===== -->
  <div id="voiceIndicator" class="voice-indicator">
    <i class="fas fa-microphone"></i>
    <p>Ouvindo... Fale o prefixo do equipamento</p>
  </div>

  <!-- ===== MODAL DE VISUALIZAÇÃO DE IMAGEM ===== -->
  <div id="imageModal" class="image-modal">
    <img id="imageModalImg" src="" alt="Preview">
  </div>

<!-- ===== INDICADOR DE ATALHOS ===== -->
<div id="shortcutHint" class="shortcut-hint">
  <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">N</span> Novo Equipamento</div>
  <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">1/2/3</span> Alternar Abas</div>
  <div><span class="shortcut-key">Esc</span> Fechar Modal</div>
</div>

  <!-- ===== BIBLIOTECAS DO FIREBASE ===== -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- ===== SCRIPT PRINCIPAL DO SISTEMA ===== -->
  <script>
    // ===================================================================
    
    
    
    // CONFIGURAÇÃO PRINCIPAL DO SISTEMA - CORRIGIDA
    // ===================================================================
    
    /*
     * CONFIGURAÇÕES DO FIREBASE
     * Estas são as credenciais para conectar com o Firebase Firestore
     * Responsável pelo armazenamento em nuvem dos dados
     */
    const firebaseConfig = {
      apiKey: "AIzaSyCGWcYx0EjUMfp7Up4BJIFlZBamOldsBZM",
      authDomain: "sistema-equipamentos-web.firebaseapp.com",
      projectId: "sistema-equipamentos-web",
      storageBucket: "sistema-equipamentos-web.firebasestorage.app",
      messagingSenderId: "1004971035686",
      appId: "1:1004971035686:web:c2de0aa19167b9a9246ae7"
    };

    // ===== SENHA DE ADMINISTRADOR PARA OPERAÇÕES CRÍTICAS =====
    const ADMIN_PASSWORD = 'wmoldes2026';
    
    // ===== VARIÁVEIS GLOBAIS DO SISTEMA =====
    let useFirestore = false; // Controla se usa Firebase ou localStorage
    let db = null; // Instância do Firestore
    let unsubEquipmentSnapshot = null; // Listener dos equipamentos
    let unsubVideoSnapshot = null; // Listener dos vídeos
    let equipmentData = []; // Array com todos os equipamentos
    let videoData = []; // Array com todos os vídeos
    let currentFilter = 'all'; // Filtro atual ('all', 'production', 'out')
    let currentLang = 'pt'; // Idioma atual da interface
    let currentHighlightedEquipment = null; // Equipamento destacado por voz
    
    // ===== VARIÁVEIS DE PAGINAÇÃO =====
    let currentPage = 1; // Página atual
    const itemsPerPage = 9; // Itens por página
    
    // ===== VARIÁVEIS DE ORDENAÇÃO =====
    let currentSort = 'prefix-asc'; // Ordenação atual
    
    // ===== VARIÁVEIS DE TEMA =====
    let darkMode = false; // Controla modo escuro/claro



    // ===================================================================
    // ELEMENTOS DA INTERFACE - CAPTURA DE TODOS OS ELEMENTOS DOM
    // ===================================================================
    const equipmentGrid = document.getElementById('equipmentGrid');
    const addButton = document.getElementById('addButton');
    const addModal = document.getElementById('addModal');
    const editModal = document.getElementById('editModal');
    const viewModal = document.getElementById('viewModal');
    const addForm = document.getElementById('addForm');
    const editForm = document.getElementById('editForm');
    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const filters = document.querySelectorAll('.filter-button');
    const notificationEl = document.getElementById('notification');
    const totalEquipment = document.getElementById('totalEquipment');
    const totalProduction = document.getElementById('totalProduction');
    const totalOut = document.getElementById('totalOut');
    const langToggle = document.getElementById('langToggle');
    const defectsButton = document.getElementById('defectsButton');
    const defectsModal = document.getElementById('defectsModal');
    const defectSelect = document.getElementById('defectSelect');
    const defectInfo = document.getElementById('defectInfo');
    const defectText = document.getElementById('defectText');
    const voiceSearchButton = document.getElementById('voiceSearchButton');
    const voiceIndicator = document.getElementById('voiceIndicator');
    const aiSearchInput = document.getElementById('aiSearchInput');
    const aiSearchButton = document.getElementById('aiSearchButton');
    const equipmentDetailModal = document.getElementById('equipmentDetailModal');
    const equipmentDetailContent = document.getElementById('equipmentDetailContent');
    const viewModalContent = document.getElementById('viewModalContent');
    const contactPhoto = document.getElementById('contactPhoto');
    const videoGrid = document.getElementById('videoGrid');
    const videoSearch = document.getElementById('videoSearch');
    const addVideoBtn = document.getElementById('addVideoBtn');
    const editVideoModal = document.getElementById('editVideoModal');
    const editVideoForm = document.getElementById('editVideoForm');
    const imagePreview = document.getElementById('imagePreview');
    const editImagePreview = document.getElementById('editImagePreview');
    
    // ===== NOVOS ELEMENTOS ADICIONADOS =====
    const themeToggle = document.getElementById('themeToggle');
    const sortSelect = document.getElementById('sortSelect');
    const paginationControls = document.getElementById('paginationControls');
    const prevPage = document.getElementById('prevPage');
    const nextPage = document.getElementById('nextPage');
    const pageInfo = document.getElementById('pageInfo');

    // ===================================================================
    // FUNÇÕES DE UTILIDADE DO SISTEMA
    // ===================================================================
/**
 * VERIFICA SE JÁ EXISTE UM EQUIPAMENTO COM O MESMO PREFIXO MOLDE
 * @param {string} prefixoMolde - Prefixo a ser verificado
 * @param {string} excludeId - ID a ser excluído da verificação (para edição)
 * @returns {boolean} - True se já existe, False se não existe
 */
function checkExistingPrefix(prefixoMolde, excludeId = null) {
    if (!prefixoMolde) return false;
    
    const prefixoUpper = prefixoMolde.toUpperCase().trim();
    
    return equipmentData.some(eq => {
        // Se for edição, exclui o próprio equipamento da verificação
        if (excludeId && eq.id === excludeId) return false;
        
        return eq.prefixoMolde && eq.prefixoMolde.toUpperCase().trim() === prefixoUpper;
    });
}

    /**
     * EXIBE NOTIFICAÇÕES TEMPORÁRIAS NA TELA
     * @param {string} msg - Mensagem a ser exibida
     * @param {string} type - Tipo da notificação ('success' ou 'error')
     */
    function showNotification(msg, type = 'success') {
      console.log(`Notificação: ${msg} (${type})`);
      notificationEl.textContent = msg;
      notificationEl.className = 'notification show ' + (type === 'success' ? 'success' : 'error');
      setTimeout(() => {
        notificationEl.className = 'notification';
      }, 3000);
    }

    /**
     * ABRE UM MODAL ESPECÍFICO
     * @param {HTMLElement} modal - Elemento modal a ser aberto
     */
    function openModal(modal) {
      modal.classList.add('show');
      modal.setAttribute('aria-hidden', 'false');
    }

    /**
     * FECHA UM MODAL ESPECÍFICO
     * @param {HTMLElement} modal - Elemento modal a ser fechado
     */
    function closeModal(modal) {
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden', 'true');
    }

    // ===== CONFIGURAÇÃO DOS BOTÕES DE FECHAR MODAL =====
    document.querySelectorAll('[data-close]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const id = btn.getAttribute('data-close');
        const m = document.getElementById(id);
        if (m) closeModal(m);
      });
    });

    // ===== CONFIGURAÇÃO DO FECHAMENTO DE MODAL AO CLICAR FORA =====
    document.querySelectorAll('.modal').forEach(mod => {
      mod.addEventListener('click', (e) => {
        if (e.target === mod) closeModal(mod);
      });
    });

    // ===================================================================
    // SISTEMA DE TEMA (MODO ESCURO/CLARO)
    // ===================================================================
    
    /**
     * ALTERNA ENTRE MODO ESCURO E MODO CLARO
     */
    function toggleTheme() {
      darkMode = !darkMode;
      if (darkMode) {
        document.body.classList.add('dark-mode');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i> <span id="themeText">Modo Claro</span>';
      } else {
        document.body.classList.remove('dark-mode');
        themeToggle.innerHTML = '<i class="fas fa-moon"></i> <span id="themeText">Modo Escuro</span>';
      }
      
      // Salva a preferência no localStorage
      localStorage.setItem('darkMode', darkMode);
    }
    
    /**
     * INICIALIZA O TEMA COM BASE NAS PREFERÊNCIAS SALVAS OU DO SISTEMA
     */
    function initTheme() {
      // Verifica se há uma preferência salva no localStorage
      const savedDarkMode = localStorage.getItem('darkMode');
      if (savedDarkMode !== null) {
        darkMode = savedDarkMode === 'true';
      } else {
        // Verifica a preferência do sistema
        darkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      }
      
      // Aplica o tema
      if (darkMode) {
        document.body.classList.add('dark-mode');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i> <span id="themeText">Modo Claro</span>';
      } else {
        document.body.classList.remove('dark-mode');
        themeToggle.innerHTML = '<i class="fas fa-moon"></i> <span id="themeText">Modo Escuro</span>';
      }
    }
    
    // Configura o botão de alternar tema
    themeToggle.addEventListener('click', toggleTheme);

    // ===================================================================
    // SISTEMA DE TRADUÇÃO (INTERNACIONALIZAÇÃO)
    // ===================================================================

   const translations = {
  pt: {
    // Cabeçalho e controles
    appTitle: 'Gerenciador de Equipamentos Completo',
    connected: 'Conectado ao Firestore: <strong>sistema de equipamentos</strong>.',
    themeDark: 'Modo Escuro',
    themeLight: 'Modo Claro',
    
    // Dashboard
    totalEquipmentLabel: 'Total de Equipamentos',
    totalProductionLabel: 'Em Produção',
    totalOutLabel: 'Fora de Produção',
    
    // Abas
    tabEquip: 'Equipamentos',
    tabVideos: 'Video Aulas', 
    tabContact: 'Contato',
    
    // Lista de equipamentos
    listTitle: 'Lista de Equipamentos',
    addNew: 'Novo Equipamento',
    defects: 'Defeitos',
    filterAll: 'Todos',
    filterProduction: 'Em Produção',
    filterOut: 'Fora de Produção',
    searchPlaceholder: 'Buscar por prefixo (Molde / Blank)...',
    searchButton: 'Procurar',
    
    // Busca por voz
    voiceSearchTitle: 'Busca por Voz - Procure por Prefixos',
    voiceSearchDesc: 'Clique no microfone e fale o prefixo do equipamento (ex: "LB-545") para ver suas informações. Diga "fechar informação" para fechar.',
    voiceButton: 'Voz',
    listening: 'Ouvindo... Fale o prefixo do equipamento',
    
    // Modal equipamentos
    addModalTitle: 'Novo Equipamento',
    editModalTitle: 'Editar Equipamento',
    viewModalTitle: 'Visualizar Equipamento',
    saveButton: 'Salvar',
    cancelButton: 'Cancelar',
    editButton: 'Editar',
    deleteButton: 'Excluir',
    copyButton: 'Copiar',
    viewButton: 'Visualizar',
    
    // Modal defeitos
    defectsModalTitle: 'Defeitos',
    selectDefect: 'Selecione o defeito',
    defectInfo: 'Informações',
    
    // Vídeos
    videosTitle: 'Video Aulas',
    totalVideos: 'Total',
    videoSearchPlaceholder: 'Buscar vídeos por título ou descrição...',
    addVideoTitle: 'Adicionar Novo Vídeo',
    videoTitle: 'Título',
    videoDescription: 'Descrição',
    videoUrl: 'URL do Vídeo (YouTube, Vimeo, ou arquivo MP4 do GitHub)',
    videoThumbnail: 'Thumbnail (URL da Imagem - opcional)',
    saveVideo: 'Salvar Vídeo',
    editVideo: 'Editar Vídeo',
    
    // Contato
    contactRole: 'Desenvolvedor & Suporte Técnico',
    contactPhone: 'Telefone',
    contactEmail: 'E-mail',
    contactNote: 'Entre em contato para suporte técnico, dúvidas ou solicitações de melhorias no sistema.',
    
    // Notificações
    notificationCopied: 'Dados copiados!',
    equipmentAdded: 'Equipamento adicionado com sucesso!',
    equipmentUpdated: 'Equipamento atualizado com sucesso!',
    equipmentDeleted: 'Equipamento excluído com sucesso!',
    videoAdded: 'Vídeo adicionado com sucesso!',
    videoUpdated: 'Vídeo atualizado com sucesso!',
    videoDeleted: 'Vídeo excluído com sucesso!',
    
    // Paginação
    pageInfo: 'Página',
    of: 'de',
    previous: 'Anterior',
    next: 'Próxima',
    
    // Ordenação
    sortPrefixAsc: 'Prefixo (A-Z)',
    sortPrefixDesc: 'Prefixo (Z-A)',
    sortDateNewest: 'Mais Recentes',
    sortDateOldest: 'Mais Antigos'
  },

  en: {
    // Header and controls
    appTitle: 'Equipment Manager Complete',
    connected: 'Connected to Firestore: <strong>equipment system</strong>.',
    themeDark: 'Dark Mode',
    themeLight: 'Light Mode',
    
    // Dashboard
    totalEquipmentLabel: 'All Equipment',
    totalProductionLabel: 'In Production',
    totalOutLabel: 'Out of Production',
    
    // Tabs
    tabEquip: 'Equipment',
    tabVideos: 'Video Tutorials',
    tabContact: 'Contact',
    
    // Equipment list
    listTitle: 'Equipment List',
    addNew: 'New Equipment',
    defects: 'Defects',
    filterAll: 'All',
    filterProduction: 'In Production',
    filterOut: 'Out of Production',
    searchPlaceholder: 'Search by prefix (Mold / Blank)...',
    searchButton: 'Search',
    
    // Voice search
    voiceSearchTitle: 'Voice Search - Search by Prefixes',
    voiceSearchDesc: 'Click the microphone and speak the equipment prefix (ex: "LB-545") to see its information. Say "close information" to close.',
    voiceButton: 'Voice',
    listening: 'Listening... Speak the equipment prefix',
    
    // Equipment modals
    addModalTitle: 'New Equipment',
    editModalTitle: 'Edit Equipment',
    viewModalTitle: 'View Equipment',
    saveButton: 'Save',
    cancelButton: 'Cancel',
    editButton: 'Edit',
    deleteButton: 'Delete',
    copyButton: 'Copy',
    viewButton: 'View',
    
    // Defects modal
    defectsModalTitle: 'Defects',
    selectDefect: 'Select defect',
    defectInfo: 'Information',
    
    // Videos
    videosTitle: 'Video Tutorials',
    totalVideos: 'Total',
    videoSearchPlaceholder: 'Search videos by title or description...',
    addVideoTitle: 'Add New Video',
    videoTitle: 'Title',
    videoDescription: 'Description',
    videoUrl: 'Video URL (YouTube, Vimeo, or GitHub MP4 file)',
    videoThumbnail: 'Thumbnail (Image URL - optional)',
    saveVideo: 'Save Video',
    editVideo: 'Edit Video',
    
    // Contact
    contactRole: 'Developer & Technical Support',
    contactPhone: 'Phone',
    contactEmail: 'Email',
    contactNote: 'Contact for technical support, questions or system improvement requests.',
    
    // Notifications
    notificationCopied: 'Data copied!',
    equipmentAdded: 'Equipment added successfully!',
    equipmentUpdated: 'Equipment updated successfully!',
    equipmentDeleted: 'Equipment deleted successfully!',
    videoAdded: 'Video added successfully!',
    videoUpdated: 'Video updated successfully!',
    videoDeleted: 'Video deleted successfully!',
    
    // Pagination
    pageInfo: 'Page',
    of: 'of',
    previous: 'Previous',
    next: 'Next',
    
    // Sorting
    sortPrefixAsc: 'Prefix (A-Z)',
    sortPrefixDesc: 'Prefix (Z-A)',
    sortDateNewest: 'Newest',
    sortDateOldest: 'Oldest'
  },

  it: {
    // Intestazione e controlli
    appTitle: 'Gestione Completa Attrezzatura',
    connected: 'Connesso a Firestore: <strong>sistema attrezzatura</strong>.',
    themeDark: 'Modalità Scura',
    themeLight: 'Modalità Chiara',
    
    // Dashboard
    totalEquipmentLabel: 'Totale Attrezzature',
    totalProductionLabel: 'In Produzione',
    totalOutLabel: 'Fuori Produzione',
    
    // Schede
    tabEquip: 'Attrezzature',
    tabVideos: 'Video Lezioni',
    tabContact: 'Contatto',
    
    // Lista attrezzature
    listTitle: 'Lista Attrezzature',
    addNew: 'Nuova Attrezzatura',
    defects: 'Difetti',
    filterAll: 'Tutti',
    filterProduction: 'In Produzione',
    filterOut: 'Fuori Produzione',
    searchPlaceholder: 'Cerca per prefisso (Stampo / Blank)...',
    searchButton: 'Cerca',
    
    // Ricerca vocale
    voiceSearchTitle: 'Ricerca Vocale - Cerca per Prefissi',
    voiceSearchDesc: 'Clicca il microfono e pronuncia il prefisso dell\'attrezzatura (es: "LB-545") per vedere le sue informazioni. Di "chiudi informazione" per chiudere.',
    voiceButton: 'Voce',
    listening: 'Ascoltando... Pronuncia il prefisso dell\'attrezzatura',
    
    // Modal attrezzature
    addModalTitle: 'Nuova Attrezzatura',
    editModalTitle: 'Modifica Attrezzatura',
    viewModalTitle: 'Visualizza Attrezzatura',
    saveButton: 'Salva',
    cancelButton: 'Annulla',
    editButton: 'Modifica',
    deleteButton: 'Elimina',
    copyButton: 'Copia',
    viewButton: 'Visualizza',
    
    // Modal difetti
    defectsModalTitle: 'Difetti',
    selectDefect: 'Seleziona difetto',
    defectInfo: 'Informazioni',
    
    // Video
    videosTitle: 'Video Lezioni',
    totalVideos: 'Totale',
    videoSearchPlaceholder: 'Cerca video per titolo o descrizione...',
    addVideoTitle: 'Aggiungi Nuovo Video',
    videoTitle: 'Titolo',
    videoDescription: 'Descrizione',
    videoUrl: 'URL Video (YouTube, Vimeo, o file MP4 GitHub)',
    videoThumbnail: 'Thumbnail (URL Immagine - opzionale)',
    saveVideo: 'Salva Video',
    editVideo: 'Modifica Video',
    
    // Contatto
    contactRole: 'Sviluppatore & Supporto Tecnico',
    contactPhone: 'Telefono',
    contactEmail: 'Email',
    contactNote: 'Contatta per supporto tecnico, domande o richieste di miglioramento del sistema.',
    
    // Notifiche
    notificationCopied: 'Dati copiati!',
    equipmentAdded: 'Attrezzatura aggiunta con successo!',
    equipmentUpdated: 'Attrezzatura aggiornata con successo!',
    equipmentDeleted: 'Attrezzatura eliminata con successo!',
    videoAdded: 'Video aggiunto con successo!',
    videoUpdated: 'Video aggiornato con successo!',
    videoDeleted: 'Video eliminato con successo!',
    
    // Impaginazione
    pageInfo: 'Pagina',
    of: 'di',
    previous: 'Precedente',
    next: 'Prossima',
    
    // Ordinamento
    sortPrefixAsc: 'Prefisso (A-Z)',
    sortPrefixDesc: 'Prefisso (Z-A)',
    sortDateNewest: 'Più Recenti',
    sortDateOldest: 'Più Antichi'
  },

  zh: {
    // 页眉和控件
    appTitle: '设备管理系统',
    connected: '已连接到 Firestore: <strong>设备系统</strong>.',
    themeDark: '深色模式',
    themeLight: '浅色模式',
    
    // 仪表板
    totalEquipmentLabel: '设备总数',
    totalProductionLabel: '生产中',
    totalOutLabel: '停产中',
    
    // 标签页
    tabEquip: '设备',
    tabVideos: '视频教程',
    tabContact: '联系',
    
    // 设备列表
    listTitle: '设备列表',
    addNew: '新设备',
    defects: '缺陷',
    filterAll: '全部',
    filterProduction: '生产中',
    filterOut: '停产中',
    searchPlaceholder: '按前缀搜索（模具/空白）...',
    searchButton: '搜索',
    
    // 语音搜索
    voiceSearchTitle: '语音搜索 - 按前缀搜索',
    voiceSearchDesc: '点击麦克风并说出设备前缀（例如："LB-545"）查看其信息。说"关闭信息"来关闭。',
    voiceButton: '语音',
    listening: '正在聆听... 请说出设备前缀',
    
    // 设备弹窗
    addModalTitle: '新设备',
    editModalTitle: '编辑设备',
    viewModalTitle: '查看设备',
    saveButton: '保存',
    cancelButton: '取消',
    editButton: '编辑',
    deleteButton: '删除',
    copyButton: '复制',
    viewButton: '查看',
    
    // 缺陷弹窗
    defectsModalTitle: '缺陷',
    selectDefect: '选择缺陷',
    defectInfo: '信息',
    
    // 视频
    videosTitle: '视频教程',
    totalVideos: '总计',
    videoSearchPlaceholder: '按标题或描述搜索视频...',
    addVideoTitle: '添加新视频',
    videoTitle: '标题',
    videoDescription: '描述',
    videoUrl: '视频URL（YouTube、Vimeo或GitHub MP4文件）',
    videoThumbnail: '缩略图（图片URL - 可选）',
    saveVideo: '保存视频',
    editVideo: '编辑视频',
    
    // 联系
    contactRole: '开发人员 & 技术支持',
    contactPhone: '电话',
    contactEmail: '邮箱',
    contactNote: '联系获取技术支持、问题解答或系统改进请求。',
    
    // 通知
    notificationCopied: '数据已复制！',
    equipmentAdded: '设备添加成功！',
    equipmentUpdated: '设备更新成功！',
    equipmentDeleted: '设备删除成功！',
    videoAdded: '视频添加成功！',
    videoUpdated: '视频更新成功！',
    videoDeleted: '视频删除成功！',
    
    // 分页
    pageInfo: '页面',
    of: '的',
    previous: '上一页',
    next: '下一页',
    
    // 排序
    sortPrefixAsc: '前缀 (A-Z)',
    sortPrefixDesc: '前缀 (Z-A)',
    sortDateNewest: '最新',
    sortDateOldest: '最旧'
  },

  ja: {
    // ヘッダーとコントロール
    appTitle: '設備管理システム',
    connected: 'Firestoreに接続済み: <strong>設備システム</strong>.',
    themeDark: 'ダークモード',
    themeLight: 'ライトモード',
    
    // ダッシュボード
    totalEquipmentLabel: '設備総数',
    totalProductionLabel: '生産中',
    totalOutLabel: '生産停止中',
    
    // タブ
    tabEquip: '設備',
    tabVideos: 'ビデオチュートリアル',
    tabContact: '連絡先',
    
    // 設備リスト
    listTitle: '設備一覧',
    addNew: '新規設備',
    defects: '不具合',
    filterAll: 'すべて',
    filterProduction: '生産中',
    filterOut: '生産停止中',
    searchPlaceholder: 'プレフィックスで検索（金型/ブランク）...',
    searchButton: '検索',
    
    // 音声検索
    voiceSearchTitle: '音声検索 - プレフィックスで検索',
    voiceSearchDesc: 'マイクをクリックして設備のプレフィックス（例："LB-545"）を話すと情報が表示されます。「情報を閉じる」と言って閉じます。',
    voiceButton: '音声',
    listening: '聞いています... 設備のプレフィックスを話してください',
    
    // 設備モーダル
    addModalTitle: '新規設備',
    editModalTitle: '設備編集',
    viewModalTitle: '設備表示',
    saveButton: '保存',
    cancelButton: 'キャンセル',
    editButton: '編集',
    deleteButton: '削除',
    copyButton: 'コピー',
    viewButton: '表示',
    
    // 不具合モーダル
    defectsModalTitle: '不具合',
    selectDefect: '不具合を選択',
    defectInfo: '情報',
    
    // ビデオ
    videosTitle: 'ビデオチュートリアル',
    totalVideos: '合計',
    videoSearchPlaceholder: 'タイトルまたは説明でビデオを検索...',
    addVideoTitle: '新規ビデオ追加',
    videoTitle: 'タイトル',
    videoDescription: '説明',
    videoUrl: 'ビデオURL（YouTube、Vimeo、GitHub MP4ファイル）',
    videoThumbnail: 'サムネイル（画像URL - 任意）',
    saveVideo: 'ビデオ保存',
    editVideo: 'ビデオ編集',
    
    // 連絡先
    contactRole: '開発者 & テクニカルサポート',
    contactPhone: '電話',
    contactEmail: 'メール',
    contactNote: 'テクニカルサポート、質問、システム改善のリクエストはこちらまでご連絡ください。',
    
    // 通知
    notificationCopied: 'データをコピーしました！',
    equipmentAdded: '設備を正常に追加しました！',
    equipmentUpdated: '設備を正常に更新しました！',
    equipmentDeleted: '設備を正常に削除しました！',
    videoAdded: 'ビデオを正常に追加しました！',
    videoUpdated: 'ビデオを正常に更新しました！',
    videoDeleted: 'ビデオを正常に削除しました！',
    
    // ページネーション
    pageInfo: 'ページ',
    of: 'の',
    previous: '前へ',
    next: '次へ',
    
    // ソート
    sortPrefixAsc: 'プレフィックス (A-Z)',
    sortPrefixDesc: 'プレフィックス (Z-A)',
    sortDateNewest: '最新',
    sortDateOldest: '最古'
  }
};
    /**
     * APLICA AS TRADUÇÕES PARA O IDIOMA SELECIONADO
     * @param {string} lang - Código do idioma ('pt', 'en', etc.)
     */
    function applyLanguage(lang) {
  currentLang = lang;
  const t = translations[lang] || translations.pt;
  
  // Atualiza todos os textos da interface
  document.getElementById('appTitle').textContent = t.appTitle;
  document.querySelectorAll('.config-note').forEach(el => el.innerHTML = t.connected);
  
  // Dashboard
  document.getElementById('totalEquipmentLabel').textContent = t.totalEquipmentLabel;
  document.getElementById('totalProductionLabel').textContent = t.totalProductionLabel;
  document.getElementById('totalOutLabel').textContent = t.totalOutLabel;
  
  // Abas - CORREÇÃO AQUI
  document.getElementById('tabEquip').textContent = t.tabEquip;
  document.getElementById('tabVideos').textContent = t.tabVideos;
  document.getElementById('tabContato').textContent = t.tabContact;
  
  // Lista de equipamentos
  document.getElementById('listTitle').textContent = t.listTitle;
  document.getElementById('addBtnText').textContent = t.addNew;
  document.getElementById('defectsBtnText').textContent = t.defects;
  document.getElementById('filterAll').textContent = t.filterAll;
  document.getElementById('filterProduction').textContent = t.filterProduction;
  document.getElementById('filterOut').textContent = t.filterOut;
  document.getElementById('searchInput').placeholder = t.searchPlaceholder;
  document.getElementById('searchBtnText').textContent = t.searchButton;
  
  // Busca por voz - CORREÇÃO COMPLETA AQUI
  const aiSearchTitle = document.querySelector('.ai-search-title span');
  if (aiSearchTitle) aiSearchTitle.textContent = t.voiceSearchTitle;
  
  const aiSearchDesc = document.querySelector('.ai-search-description');
  if (aiSearchDesc) aiSearchDesc.textContent = t.voiceSearchDesc;
  
  const voiceButton = document.getElementById('voiceSearchButton');
  if (voiceButton) voiceButton.innerHTML = `<i class="fas fa-microphone"></i> ${t.voiceButton}`;
  
  const voiceIndicator = document.querySelector('.voice-indicator p');
  if (voiceIndicator) voiceIndicator.textContent = t.listening;
  
  const aiSearchInput = document.getElementById('aiSearchInput');
  if (aiSearchInput) aiSearchInput.placeholder = t.voiceSearchPlaceholder || 'Ou digite o prefixo do equipamento...';
  
  const aiSearchButton = document.getElementById('aiSearchButton');
  if (aiSearchButton) aiSearchButton.innerHTML = `<i class="fas fa-search"></i> ${t.searchButton}`;
  
  // Modais de equipamentos
  document.getElementById('addModalTitleText').textContent = t.addModalTitle;
  document.getElementById('editModalTitleText').textContent = t.editModalTitle;
  document.getElementById('equipmentDetailTitle').textContent = t.viewModalTitle;
  
  // Botões gerais
  document.getElementById('saveBtnText').textContent = t.saveButton;
  if (document.getElementById('cancelBtnText')) {
    document.getElementById('cancelBtnText').textContent = t.cancelButton;
  }
  if (document.getElementById('cancelEditBtnText')) {
    document.getElementById('cancelEditBtnText').textContent = t.cancelButton;
  }
  if (document.getElementById('saveEditBtnText')) {
    document.getElementById('saveEditBtnText').textContent = t.saveButton;
  }
  
  // Modal de defeitos
  document.getElementById('defectsModalTitle').textContent = t.defectsModalTitle;
  document.querySelector('label[for="defectSelect"]').textContent = t.selectDefect;
  document.querySelector('#defectInfo label').textContent = t.defectInfo;
  
  // Vídeos - CORREÇÃO AQUI
  const videosTitle = document.querySelector('#tabContentVideos h2 span');
  if (videosTitle) {
    videosTitle.innerHTML = `<i class="fas fa-video"></i> ${t.videosTitle}`;
  }
  
  const videoSearchInput = document.getElementById('videoSearch');
  if (videoSearchInput) videoSearchInput.placeholder = t.videoSearchPlaceholder;
  
  const videoAddTitle = document.querySelector('.video-add h3');
  if (videoAddTitle) videoAddTitle.textContent = t.addVideoTitle;
  
  const videoTitleLabel = document.querySelector('label[for="videoTitulo"]');
  if (videoTitleLabel) videoTitleLabel.textContent = t.videoTitle;
  
  const videoDescLabel = document.querySelector('label[for="videoDescricao"]');
  if (videoDescLabel) videoDescLabel.textContent = t.videoDescription;
  
  const videoUrlLabel = document.querySelector('label[for="videoUrl"]');
  if (videoUrlLabel) videoUrlLabel.textContent = t.videoUrl;
  
  const videoThumbLabel = document.querySelector('label[for="videoThumbnail"]');
  if (videoThumbLabel) videoThumbLabel.textContent = t.videoThumbnail;
  
  const addVideoBtn = document.getElementById('addVideoBtn');
  if (addVideoBtn) addVideoBtn.innerHTML = `<i class="fas fa-save"></i> ${t.saveVideo}`;
  
  // Contato - CORREÇÃO COMPLETA AQUI
  const contactRole = document.querySelector('.contact-role');
  if (contactRole) contactRole.textContent = t.contactRole;
  
  const contactPhoneLabel = document.querySelector('.contact-item:nth-child(1) .contact-label');
  if (contactPhoneLabel) contactPhoneLabel.textContent = t.contactPhone;
  
  const contactEmailLabel = document.querySelector('.contact-item:nth-child(2) .contact-label');
  if (contactEmailLabel) contactEmailLabel.textContent = t.contactEmail;
  
  const contactNote = document.querySelector('.contact-note');
  if (contactNote) contactNote.innerHTML = `<i class="fas fa-info-circle"></i> ${t.contactNote}`;
  
  // Paginação
  prevPage.innerHTML = `<i class="fas fa-chevron-left"></i> ${t.previous}`;
  nextPage.innerHTML = `${t.next} <i class="fas fa-chevron-right"></i>`;
  
  // Ordenação
  document.querySelector('option[value="prefix-asc"]').textContent = t.sortPrefixAsc;
  document.querySelector('option[value="prefix-desc"]').textContent = t.sortPrefixDesc;
  document.querySelector('option[value="date-newest"]').textContent = t.sortDateNewest;
  document.querySelector('option[value="date-oldest"]').textContent = t.sortDateOldest;
  
  // Tema
  const themeText = document.getElementById('themeText');
  if (themeText) {
    themeText.textContent = darkMode ? t.themeLight : t.themeDark;
  }
  
  // Re-renderiza os equipamentos e vídeos com os novos textos
  renderEquipment(getCurrentPageData());
  renderVideos(videoData);
}

    // Configura o seletor de idioma
    langToggle.addEventListener('change', (e) => {
      applyLanguage(e.target.value);
    });

    // ===================================================================
    // SISTEMA DE COPIA DE CONTATO (TELEFONE/E-MAIL)
    // ===================================================================

    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('copy-btn') || e.target.closest('.copy-btn')) {
        const button = e.target.classList.contains('copy-btn') ? e.target : e.target.closest('.copy-btn');
        const textToCopy = button.getAttribute('data-text');
        
        // Usa a API de Clipboard para copiar o texto
        navigator.clipboard.writeText(textToCopy).then(() => {
          showNotification('Texto copiado para a área de transferência!');
        }).catch(err => {
          console.error('Erro ao copiar: ', err);
          showNotification('Erro ao copiar texto', 'error');
        });
      }
    });

    // ===================================================================
    // SISTEMA DE ORDENAÇÃO DE EQUIPAMENTOS
    // ===================================================================
    
    /**
     * ORDENA OS EQUIPAMENTOS COM BASE NO CRITÉRIO SELECIONADO
     * @param {Array} data - Array de equipamentos a ser ordenado
     * @returns {Array} - Array ordenado
     */
    function sortEquipment(data) {
      if (!data || data.length === 0) return data;
      
      // Faz uma cópia do array para não modificar o original
      const sortedData = [...data];
      
      switch(currentSort) {
        case 'prefix-asc':
          // Ordena por prefixo (A-Z), considerando primeiro as duas letras iniciais
          sortedData.sort((a, b) => {
            const prefixA = (a.prefixoMolde || '').toUpperCase();
            const prefixB = (b.prefixoMolde || '').toUpperCase();
            
            // Extrai as duas primeiras letras
            const lettersA = prefixA.substring(0, 2);
            const lettersB = prefixB.substring(0, 2);
            
            // Extrai os números
            const numbersA = parseInt(prefixA.substring(2)) || 0;
            const numbersB = parseInt(prefixB.substring(2)) || 0;
            
            // Primeiro compara as letras
            if (lettersA !== lettersB) {
              return lettersA.localeCompare(lettersB);
            }
            
            // Se as letras são iguais, compara os números
            return numbersA - numbersB;
          });
          break;
          
        case 'prefix-desc':
          // Ordena por prefixo (Z-A), considerando primeiro as duas letras iniciais
          sortedData.sort((a, b) => {
            const prefixA = (a.prefixoMolde || '').toUpperCase();
            const prefixB = (b.prefixoMolde || '').toUpperCase();
            
            // Extrai as duas primeiras letras
            const lettersA = prefixA.substring(0, 2);
            const lettersB = prefixB.substring(0, 2);
            
            // Extrai os números
            const numbersA = parseInt(prefixA.substring(2)) || 0;
            const numbersB = parseInt(prefixB.substring(2)) || 0;
            
            // Primeiro compara as letras
            if (lettersA !== lettersB) {
              return lettersB.localeCompare(lettersA);
            }
            
            // Se as letras são iguais, compara os números
            return numbersB - numbersA;
          });
          break;
          
        case 'date-newest':
          // Ordena por data de criação (mais recentes primeiro)
          sortedData.sort((a, b) => {
            const dateA = new Date(a.criadoEm || 0);
            const dateB = new Date(b.criadoEm || 0);
            return dateB - dateA;
          });
          break;
          
        case 'date-oldest':
          // Ordena por data de criação (mais antigos primeiro)
          sortedData.sort((a, b) => {
            const dateA = new Date(a.criadoEm || 0);
            const dateB = new Date(b.criadoEm || 0);
            return dateA - dateB;
          });
          break;
          
        default:
          // Ordenação padrão (por prefixo ascendente)
          sortedData.sort((a, b) => {
            const prefixA = (a.prefixoMolde || '').toUpperCase();
            const prefixB = (b.prefixoMolde || '').toUpperCase();
            
            const lettersA = prefixA.substring(0, 2);
            const lettersB = prefixB.substring(0, 2);
            
            const numbersA = parseInt(prefixA.substring(2)) || 0;
            const numbersB = parseInt(prefixB.substring(2)) || 0;
            
            if (lettersA !== lettersB) {
              return lettersA.localeCompare(lettersB);
            }
            
            return numbersA - numbersB;
          });
      }
      
      return sortedData;
    }
    
    // Configura o seletor de ordenação
    sortSelect.addEventListener('change', (e) => {
      currentSort = e.target.value;
      currentPage = 1; // Volta para a primeira página ao mudar a ordenação
      renderEquipment(getCurrentPageData());
    });
    
    // ===================================================================
// SISTEMA DE ATALHOS DE TECLADO
// ===================================================================

/**
 * CONFIGURA TODOS OS ATALHOS DE TECLADO
 */
function setupKeyboardShortcuts() {
    document.addEventListener('keydown', function(e) {
        // Ctrl + 1, 2, 3 - Alternar abas
        if (e.ctrlKey && e.key >= '1' && e.key <= '3') {
            e.preventDefault();
            const tabIndex = parseInt(e.key) - 1;
            const tabs = [tabEquip, tabVideos, tabContato];
            if (tabs[tabIndex]) {
                tabs[tabIndex].click();
                showShortcutHint(`Aba ${tabs[tabIndex].textContent} ativada`);
            }
        }

        // Ctrl + N - Novo equipamento
        if (e.ctrlKey && e.key === 'n') {
            e.preventDefault();
            openAddModal();
            showShortcutHint('Modal de novo equipamento aberto');
        }

        // Ctrl + F - Focar na busca
        if (e.ctrlKey && e.key === 'f') {
            e.preventDefault();
            searchInput.focus();
            searchInput.select();
            showShortcutHint('Busca focada');
        }

        // Ctrl + K - Busca inteligente
        if (e.ctrlKey && e.key === 'k') {
            e.preventDefault();
            aiSearchInput.focus();
            aiSearchInput.select();
            showShortcutHint('Busca inteligente focada');
        }

        // Ctrl + Espaço - Busca por voz
        if (e.ctrlKey && e.key === ' ') {
            e.preventDefault();
            startVoiceRecognition();
            showShortcutHint('Busca por voz ativada');
        }

        // Esc - Fechar modais
        if (e.key === 'Escape') {
            const openModals = document.querySelectorAll('.modal.show');
            if (openModals.length > 0) {
                openModals.forEach(modal => closeModal(modal));
                showShortcutHint('Modal fechado');
            }
        }

        // F1, F2, F3 - Filtros rápidos
        if (e.key === 'F1') {
            e.preventDefault();
            document.querySelector('[data-filter="all"]').click();
            showShortcutHint('Filtro: Todos ativado');
        }
        if (e.key === 'F2') {
            e.preventDefault();
            document.querySelector('[data-filter="production"]').click();
            showShortcutHint('Filtro: Em produção ativado');
        }
        if (e.key === 'F3') {
            e.preventDefault();
            document.querySelector('[data-filter="out"]').click();
            showShortcutHint('Filtro: Fora de produção ativado');
        }

        // Ctrl + T - Alternar tema
        if (e.ctrlKey && e.key === 't') {
            e.preventDefault();
            toggleTheme();
            showShortcutHint('Tema alternado');
        }

        // Ctrl + L - Alternar idioma
        if (e.ctrlKey && e.key === 'l') {
            e.preventDefault();
            // Alterna entre Português e Inglês
            const newLang = currentLang === 'pt' ? 'en' : 'pt';
            langToggle.value = newLang;
            applyLanguage(newLang);
            showShortcutHint(`Idioma: ${newLang === 'pt' ? 'Português' : 'English'}`);
        }

        // Ctrl + S - Salvar (quando em modais)
        if (e.ctrlKey && e.key === 's') {
            e.preventDefault();
            const activeModal = document.querySelector('.modal.show');
            if (activeModal && activeModal.id === 'addModal') {
                addForm.requestSubmit();
                showShortcutHint('Equipamento salvo');
            }
            if (activeModal && activeModal.id === 'editModal') {
                editForm.requestSubmit();
                showShortcutHint('Alterações salvas');
            }
        }

        // Ctrl + → e Ctrl + ← - Navegação entre páginas
        if (e.ctrlKey && e.key === 'ArrowRight') {
            e.preventDefault();
            if (!nextPage.disabled) {
                nextPage.click();
                showShortcutHint('Próxima página');
            }
        }
        if (e.ctrlKey && e.key === 'ArrowLeft') {
            e.preventDefault();
            if (!prevPage.disabled) {
                prevPage.click();
                showShortcutHint('Página anterior');
            }
        }

        // Ctrl + ? - Mostrar ajuda de atalhos
        if (e.ctrlKey && e.key === '?') {
            e.preventDefault();
            toggleShortcutHelp();
        }
    });
}

/**
 * MOSTRA DICA RÁPIDA DO ATALHO EXECUTADO
 */
function showShortcutHint(message) {
    const hint = document.getElementById('shortcutHint');
    hint.innerHTML = `<div>${message}</div>`;
    hint.classList.add('show');
    
    setTimeout(() => {
        hint.classList.remove('show');
    }, 2000);
}

/**
 * ALTERNAR AJUDA COMPLETA DE ATALHOS
 */
function toggleShortcutHelp() {
    const hint = document.getElementById('shortcutHint');
    
    if (hint.classList.contains('show')) {
        hint.classList.remove('show');
    } else {
        hint.innerHTML = `
            <div style="margin-bottom: 8px; font-weight: bold;">Atalhos de Teclado</div>
            <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">1/2/3</span> Alternar Abas</div>
            <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">N</span> Novo Equipamento</div>
            <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">F</span> Buscar</div>
            <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">K</span> Busca IA</div>
            <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">Espaço</span> Voz</div>
            <div><span class="shortcut-key">F1/F2/F3</span> Filtros</div>
            <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">T</span> Tema</div>
            <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">L</span> Idioma</div>
            <div><span class="shortcut-key">Ctrl</span> + <span class="shortcut-key">S</span> Salvar</div>
            <div><span class="shortcut-key">Esc</span> Fechar</div>
            <div style="margin-top: 8px; font-size: 0.7rem; opacity: 0.7;">Pressione Ctrl + ? para fechar</div>
        `;
        hint.classList.add('show');
    }
}
    
    // ===================================================================
    // SISTEMA DE PAGINAÇÃO
    // ===================================================================
    
    /**
     * OBTÉM OS DADOS DA PÁGINA ATUAL APLICANDO FILTROS E ORDENAÇÃO
     * @returns {Array} - Array com os equipamentos da página atual
     */
    function getCurrentPageData() {
      // Aplica filtros e ordenação
      let filteredData = applyCurrentFilterArray();
      filteredData = sortEquipment(filteredData);
      
      // Calcula o índice inicial e final para a página atual
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      
      // Retorna apenas os itens da página atual
      return filteredData.slice(startIndex, endIndex);
    }
    
    /**
     * ATUALIZA OS CONTROLES DE PAGINAÇÃO COM BASE NOS DADOS ATUAIS
     */
    function updatePaginationControls() {
      // Aplica filtros e ordenação para obter o total de itens
      let filteredData = applyCurrentFilterArray();
      filteredData = sortEquipment(filteredData);
      
      const totalItems = filteredData.length;
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      
      // Atualiza as informações da página
      pageInfo.textContent = `Página ${currentPage} de ${totalPages}`;
      
      // Atualiza o estado dos botões
      prevPage.disabled = currentPage <= 1;
      nextPage.disabled = currentPage >= totalPages;
      
      // Mostra ou esconde os controles de paginação
      if (totalPages > 1) {
        paginationControls.style.display = 'flex';
      } else {
        paginationControls.style.display = 'none';
      }
    }
    
    // Configura os botões de paginação
    prevPage.addEventListener('click', () => {
      if (currentPage > 1) {
        currentPage--;
        renderEquipment(getCurrentPageData());
      }
    });
    
    nextPage.addEventListener('click', () => {
      let filteredData = applyCurrentFilterArray();
      filteredData = sortEquipment(filteredData);
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      
      if (currentPage < totalPages) {
        currentPage++;
        renderEquipment(getCurrentPageData());
      }
    });

    // ===================================================================
    // SISTEMA DE RENDERIZAÇÃO DE EQUIPAMENTOS - CORRIGIDO
    // ===================================================================

    /**
     * RENDERIZA A LISTA DE EQUIPAMENTOS NA GRADE
     * @param {Array} list - Array de equipamentos a serem renderizados
     */
    function renderEquipment(list) {
      console.log(`Renderizando ${list ? list.length : 0} equipamentos`);
      equipmentGrid.innerHTML = '';
      
      // Verifica se há equipamentos para exibir
      if (!list || list.length === 0) {
        equipmentGrid.innerHTML = '<div style="grid-column:1/-1;background:var(--card-bg);padding:20px;border-radius:12px;box-shadow:var(--shadow);text-align:center">Nenhum equipamento encontrado.</div>';
        updateDashboard();
        updatePaginationControls();
        return;
      }
      
      const t = translations[currentLang] || translations.pt;
      
      // Cria um card para cada equipamento
      list.forEach(eq => {
        const card = document.createElement('div');
        // Adiciona classe highlighted se for o equipamento atualmente destacado
        card.className = currentHighlightedEquipment === eq.id ? 'equipment-card highlighted' : 'equipment-card';
        
        // Gera o HTML das imagens
        let imgHtml = '';
        if (eq.urlImg1) {
          imgHtml += `<img class="equipment-image" src="${eq.urlImg1}" alt="Imagem 1" onerror="this.style.display='none'">`;
        }
        if (eq.urlImg2) {
          imgHtml += `<img class="equipment-image" src="${eq.urlImg2}" alt="Imagem 2" onerror="this.style.display='none'">`;
        }
        if (!imgHtml) {
          imgHtml = `<div class="equipment-image" style="display:flex;align-items:center;justify-content:center;background:var(--light);color:var(--text-secondary);"><i class="fas fa-image"></i></div>`;
        }
        
        // Define cores e textos do status
        let statusColor = '#27ae60';
        let statusText = 'Em produção';
        
        if (eq.status === 'sample') {
          statusColor = '#f39c12';
          statusText = 'Amostra';
        } else if (eq.status === 'out') {
          statusColor = '#c0392b';
          statusText = 'Fora';
        }
        
        // Monta o HTML do card
        card.innerHTML = `
          <div class="images-col">
            ${imgHtml}
          </div>
          <div class="equipment-info">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="equipment-prefix">${eq.prefixoMolde || '-'}</div>
                <div class="equipment-sub">Blank: ${eq.prefixoBlank || '-'}</div>
              </div>
              <div style="text-align:right">
                <div style="font-weight:700">Classe: ${eq.classe || '-'}</div>
                <div style="font-size:0.85rem;color:${statusColor}">
                  ${statusText}
                </div>
              </div>
            </div>
            
            <div class="equipment-details"> - Corredor | ${eq.corredor || '?'} | Prateleira | ${eq.prateleira || '?'} | </div>
            
            <div class="equipment-details">- Neckrings: ${eq.neckrings || '-'}</div>
            
            <div class="equipment-details">- Aneis Guias: ${eq.aneisGuias || '-'}</div>
            

<div class="equipment-details">- Grafite Blank: ${eq.grafiteBlank || '-'}</div>

            <div class="equipment-actions">
              <button class="edit-button" data-id="${eq.id}"><i class="fas fa-edit"></i> ${t.editButton}</button>
              <button class="copy-button" data-id="${eq.id}"><i class="fas fa-copy"></i> ${t.copyButton}</button>
              <button class="delete-button" data-id="${eq.id}"><i class="fas fa-trash"></i> ${t.deleteButton}</button>
            </div>
            <button class="view-button" data-id="${eq.id}"><i class="fas fa-eye"></i> ${t.viewButton}</button>
          </div>
        `;
        
        equipmentGrid.appendChild(card);
      });

      // ===== CONFIGURA OS EVENTOS DOS BOTÕES DOS CARDS =====
      
      // Botão Editar
      document.querySelectorAll('.edit-button').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = btn.getAttribute('data-id');
          openEditModal(id);
        });
      });
      
      // Botão Copiar
      document.querySelectorAll('.copy-button').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = btn.getAttribute('data-id');
          const eq = equipmentData.find(x => x.id === id);
          if (!eq) return;
          
          // Prepara texto formatado para copiar
          const copyText = `
Prefixo Molde: ${eq.prefixoMolde || ''}
Prefixo Blank: ${eq.prefixoBlank || ''}
Processo: ${eq.processo || ''}
Neckrings: ${eq.neckrings || ''}
Aneis Guias: ${eq.aneisGuias || ''}
Thimbles: ${eq.thimble || ''}
Machos: ${eq.machos || ''}
Coolers: ${eq.coolers || ''}
Baffles: ${eq.baffles || ''}
Baffles Plugs: ${eq.bafflesPlugs || ''}
Funis: ${eq.funis || ''}
Fundos: ${eq.fundos || ''}
Fundos Plugs: ${eq.fundosPlugs || ''}
Sopradores: ${eq.sopradores || ''}
Pinças: ${eq.pincas || ''}
Almox Molde: ${eq.moldeAlmox || ''}
Almox Blank: ${eq.blankAlmox || ''}
Corredor: ${eq.corredor || ''}
Prateleira: ${eq.prateleira || ''}
`;
          
          // Tenta usar a API moderna de clipboard
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(copyText).then(() => {
              showNotification(translations[currentLang].notificationCopied);
            }).catch(err => {
              // Fallback para método antigo
              const ta = document.createElement('textarea');
              ta.value = copyText;
              document.body.appendChild(ta);
              ta.select();
              try {
                document.execCommand('copy');
                showNotification(translations[currentLang].notificationCopied);
              } catch (e) {
                alert('Falha ao copiar');
              }
              ta.remove();
            });
          } else {
            // Fallback para navegadores antigos
            const ta = document.createElement('textarea');
            ta.value = copyText;
            document.body.appendChild(ta);
            ta.select();
            try {
              document.execCommand('copy');
              showNotification(translations[currentLang].notificationCopied);
            } catch (e) {
              alert('Falha ao copiar');
            }
            ta.remove();
          }
        });
      });
      
      // Botão Excluir
      document.querySelectorAll('.delete-button').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const id = btn.getAttribute('data-id');
          
          // Solicita senha de administrador para exclusão
          const senha = prompt('Digite a senha de autorização para excluir:');
          if (String(senha || '').trim() !== String(ADMIN_PASSWORD || '').trim()) {
            alert('Senha incorreta. Exclusão cancelada.');
            return;
          }
          
          if (!confirm('Confirmar exclusão?')) return;
          
          try {
            if (useFirestore && db) {
              await deleteEquipmentFromFirestore(id);
            } else {
              equipmentData = equipmentData.filter(x => x.id !== id);
              persistLocal();
              renderEquipment(getCurrentPageData());
            }
            showNotification('Equipamento excluído com sucesso!');
          } catch (err) {
            console.error(err);
            showNotification('Erro ao excluir. Veja console.', 'error');
          }
        });
      });
      
      // Botão Visualizar
      document.querySelectorAll('.view-button').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = btn.getAttribute('data-id');
          openViewModal(id);
        });
      });

      // Configura a visualização de imagens ao clicar
      document.querySelectorAll('.equipment-image').forEach(img => {
        img.addEventListener('click', (e) => {
          if (e.target.src) {
            const imageModalImg = document.getElementById('imageModalImg');
            imageModalImg.src = e.target.src;
            document.getElementById('imageModal').classList.add('show');
          }
        });
      });

      updateDashboard();
      updatePaginationControls();
    }

    /**
     * ATUALIZA O PAINEL DE ESTATÍSTICAS (DASHBOARD)
     */
    function updateDashboard() {
      console.log(`Atualizando dashboard: ${equipmentData.length} equipamentos totais`);
      totalEquipment.textContent = equipmentData.length;
      totalProduction.textContent = equipmentData.filter(e => e.status === 'production').length;
      totalOut.textContent = equipmentData.filter(e => e.status !== 'production').length;
    }

    /**
     * APLICA O FILTRO ATUAL AO ARRAY DE EQUIPAMENTOS
     * @returns {Array} - Array filtrado
     */
    function applyCurrentFilterArray() {
      return equipmentData.filter(e => {
        if (currentFilter === 'all') return true;
        return e.status === currentFilter;
      });
    }

    // ===================================================================
    // SISTEMA DE BUSCA POR VOZ PARA PREFIXOS
    // ===================================================================

    /**
 * INICIA O RECONHECIMENTO DE VOZ PARA BUSCA INTELIGENTE
 */
function startVoiceRecognition() {
  if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
    alert('Seu navegador não suporta reconhecimento de voz. Tente usar Chrome ou Edge.');
    return;
  }
  
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  
  recognition.lang = 'pt-BR';
  recognition.continuous = false;
  recognition.interimResults = false;
  
  // Mostra indicador visual de gravação
  voiceIndicator.classList.add('show');
  voiceSearchButton.classList.add('listening');
  
  recognition.start();
  
  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    console.log('Texto reconhecido:', transcript);
    
    // Remove qualquer highlight anterior
    if (currentHighlightedEquipment) {
      const previousCard = document.querySelector(`[data-id="${currentHighlightedEquipment}"]`);
      if (previousCard) {
        previousCard.closest('.equipment-card').classList.remove('highlighted');
      }
      currentHighlightedEquipment = null;
    }
    
    // Analisa o comando de voz
    const command = analyzeVoiceCommand(transcript);
    
    if (command.action === 'close') {
      closeModal(equipmentDetailModal);
      showNotification('Informação fechada.');
      speak('Informação fechada.');
    } 
    else if (command.action === 'full_info') {
      const equipment = findEquipmentByPrefix(command.prefix);
      if (equipment) {
        currentHighlightedEquipment = equipment.id;
        renderEquipment(getCurrentPageData());
        showEquipmentFullDetails(equipment);
        speak(`Mostrando informações completas do equipamento ${command.prefix}`);
      } else {
        showNotification(`Equipamento ${command.prefix} não encontrado.`, 'error');
        speak(`Não encontrei o equipamento ${command.prefix}`);
      }
    }
    else if (command.action === 'polimento') {
      const equipment = findEquipmentByPrefix(command.prefix);
      if (equipment) {
        currentHighlightedEquipment = equipment.id;
        renderEquipment(getCurrentPageData());
        showPolimentoDetails(equipment);
        speak(`Mostrando informações de polimento do ${command.prefix}`);
      } else {
        showNotification(`Equipamento ${command.prefix} não encontrado.`, 'error');
        speak(`Não encontrei o equipamento ${command.prefix}`);
      }
    }
    else if (command.action === 'dimensional') {
      const equipment = findEquipmentByPrefix(command.prefix);
      if (equipment) {
        currentHighlightedEquipment = equipment.id;
        renderEquipment(getCurrentPageData());
        showDimensionalDetails(equipment);
        speak(`Mostrando dimensões do ${command.prefix}`);
      } else {
        showNotification(`Equipamento ${command.prefix} não encontrado.`, 'error');
        speak(`Não encontrei o equipamento ${command.prefix}`);
      }
    }
    else if (command.action === 'componentes') {
      const equipment = findEquipmentByPrefix(command.prefix);
      if (equipment) {
        currentHighlightedEquipment = equipment.id;
        renderEquipment(getCurrentPageData());
        showComponentesDetails(equipment);
        speak(`Mostrando componentes do ${command.prefix}`);
      } else {
        showNotification(`Equipamento ${command.prefix} não encontrado.`, 'error');
        speak(`Não encontrei o equipamento ${command.prefix}`);
      }
    }
    else if (command.action === 'localizacao') {
      const equipment = findEquipmentByPrefix(command.prefix);
      if (equipment) {
        currentHighlightedEquipment = equipment.id;
        renderEquipment(getCurrentPageData());
        showLocalizacaoDetails(equipment);
        speak(`Mostrando localização do ${command.prefix}`);
      } else {
        showNotification(`Equipamento ${command.prefix} não encontrado.`, 'error');
        speak(`Não encontrei o equipamento ${command.prefix}`);
      }
    }
    else {
      showNotification('Comando não reconhecido. Tente: "polimento", "dimensional", "componentes" ou "localização".', 'error');
      speak('Comando não entendido. Pode repetir?');
    }
    
    voiceIndicator.classList.remove('show');
    voiceSearchButton.classList.remove('listening');
  };
  
  recognition.onerror = function(event) {
    console.error('Erro no reconhecimento de voz:', event.error);
    
    voiceIndicator.classList.remove('show');
    voiceSearchButton.classList.remove('listening');
    
    if (event.error === 'not-allowed') {
      alert('Permissão para usar o microfone foi negada. Por favor, permita o acesso ao microfone.');
    } else if (event.error === 'audio-capture') {
      alert('Nenhum microfone foi detectado. Verifique se há um microfone conectado.');
    } else {
      alert('Erro no reconhecimento de voz: ' + event.error);
    }
  };
  
  recognition.onend = function() {
    voiceIndicator.classList.remove('show');
    voiceSearchButton.classList.remove('listening');
  };
}

/**
 * ANALISA O COMANDO DE VOZ E IDENTIFICA A INTENÇÃO
 */
function analyzeVoiceCommand(transcript) {
  const text = transcript.toLowerCase().trim();
  console.log('Analisando comando:', text);
  
  // Comando para fechar
  if (text.includes('fechar') || text.includes('sair') || text.includes('voltar')) {
    return { action: 'close' };
  }
  
  // Comandos de polimento
  const polimentoKeywords = ['polir', 'polimento', 'polidor', 'polidura', 'lixar', 'lixa'];
  const hasPolimento = polimentoKeywords.some(keyword => text.includes(keyword));
  
  // Comandos de dimensional
  const dimensionalKeywords = ['dimensional', 'dimensão', 'dimensões', 'medida', 'medidas', 'tamanho', 'diâmetro', 'diametro'];
  const hasDimensional = dimensionalKeywords.some(keyword => text.includes(keyword));
  
  // Comandos de componentes
  const componentesKeywords = ['componente', 'componentes', 'peça', 'peças', 'parte', 'partes', 'terminação', 'terminações'];
  const hasComponentes = componentesKeywords.some(keyword => text.includes(keyword));
  
  // Comandos de localização
  const localizacaoKeywords = ['localização', 'localizacao', 'local', 'posição', 'posicao', 'almoxarifado', 'prateleira', 'corredor'];
  const hasLocalizacao = localizacaoKeywords.some(keyword => text.includes(keyword));
  
  // Extrai o prefixo do equipamento
  const prefix = extractPrefixFromSpeech(transcript);
  
  if (!prefix) {
    return { action: 'unknown' };
  }
  
  // Determina a ação baseada nas palavras-chave
  if (hasPolimento) {
    return { action: 'polimento', prefix: prefix };
  } else if (hasDimensional) {
    return { action: 'dimensional', prefix: prefix };
  } else if (hasComponentes) {
    return { action: 'componentes', prefix: prefix };
  } else if (hasLocalizacao) {
    return { action: 'localizacao', prefix: prefix };
  } else {
    // Se não identificou comando específico, mostra informações completas
    return { action: 'full_info', prefix: prefix };
  }
}

/**
 * EXTRAI UM PREFIXO DE EQUIPAMENTO DO TEXTO FALADO - VERSÃO MELHORADA
 */
function extractPrefixFromSpeech(transcript) {
  // Mantém os espaços para análise correta, apenas converte para maiúsculas
  const cleanTranscript = transcript.toUpperCase();
  
  console.log('Texto recebido para análise:', cleanTranscript);
  
  // Padrões melhorados para prefixos considerando contextos de fala
  const prefixPatterns = [
    // Padrão com espaço: "LB 545", "ABC 123"
    /([A-Z]{2,3})\s+(\d{2,5})/,
    // Padrão com hífen: "LB-545", "ABC-123"  
    /([A-Z]{2,3})-(\d{2,5})/,
    // Padrão sem separador: "LB545", "ABC123"
    /([A-Z]{2,3})(\d{2,5})/,
    // Padrão mais genérico
    /[A-Z]{1,3}\d{2,5}/
  ];
  
  // Primeiro, procura por padrões específicos
  for (const pattern of prefixPatterns) {
    const match = cleanTranscript.match(pattern);
    if (match) {
      console.log('Padrão encontrado:', match[0]);
      
      // Se o padrão capturou grupos separados (letras e números), junta-os
      if (match[1] && match[2]) {
        return match[1] + match[2]; // Retorna sem espaço: "LB545"
      }
      return match[0];
    }
  }
  
  // Estratégia alternativa: procura por qualquer sequência que combine letras e números
  const combinedPattern = /[A-Z]+\d+/g;
  const allMatches = cleanTranscript.match(combinedPattern);
  
  if (allMatches && allMatches.length > 0) {
    // Filtra para pegar apenas as que parecem prefixos de equipamento
    const possiblePrefixes = allMatches.filter(match => 
      match.length >= 3 && match.length <= 8
    );
    
    if (possiblePrefixes.length > 0) {
      console.log('Possíveis prefixos encontrados:', possiblePrefixes);
      return possiblePrefixes[0]; // Retorna o primeiro que parece válido
    }
  }
  
  console.log('Nenhum prefixo identificado no texto:', cleanTranscript);
  return null;
}

/**
 * MOSTRA APENAS INFORMAÇÕES DE POLIMENTO
 */
function showPolimentoDetails(equipment) {
  equipmentDetailContent.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center; background: var(--light); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
      <div>
        <h3 style="margin: 0; color: var(--text-primary);">${equipment.prefixoMolde || 'N/A'} - Informações de Polimento</h3>
        <p style="margin: 5px 0 0; color: var(--text-secondary);">Comando de Voz: Polimento</p>
      </div>
      <div style="text-align: right;">
        <div style="font-size: 1rem; font-weight: 700; color: #3498db">POLIMENTO</div>
        <p style="margin: 5px 0 0; color: var(--text-secondary);">Informação Específica</p>
      </div>
    </div>
    
    <div class="detail-grid">
      <div class="detail-section-title">Configurações de Polimento</div>
      
      <div class="detail-group">
        <span class="detail-label">Polimento do Molde:</span>
        <span class="detail-value" style="font-weight:600;color:#2c3e50">${equipment.polimentoMolde || 'Não especificado'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Polimento do Blank:</span>
        <span class="detail-value" style="font-weight:600;color:#2c3e50">${equipment.polimentoBlank || 'Não especificado'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Tipo de Grafite:</span>
        <span class="detail-value" style="font-weight:600;color:#2c3e50">${equipment.grafite || 'Não especificado'}</span>
      </div>
      
      <div class="detail-section-title">Equipamento</div>
      
      <div class="detail-group">
        <span class="detail-label">Prefixo Molde:</span>
        <span class="detail-value">${equipment.prefixoMolde || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Prefixo Blank:</span>
        <span class="detail-value">${equipment.prefixoBlank || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Processo:</span>
        <span class="detail-value">${equipment.processo || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Classe:</span>
        <span class="detail-value">${equipment.classe || '-'}</span>
      </div>
      
      ${equipment.observacoesTopo && equipment.observacoesTopo.toLowerCase().includes('polimento') ? `
      <div class="detail-group detail-full-width">
        <span class="detail-label">Observações sobre Polimento:</span>
        <span class="detail-value">${equipment.observacoesTopo}</span>
      </div>
      ` : ''}
      
      <div class="detail-group detail-full-width" style="background:#e8f4fd;border-left:4px solid #3498db">
        <span class="detail-label">💡 Dica de Voz:</span>
        <span class="detail-value">Tente dizer: "dimensional ${equipment.prefixoMolde}" para ver as medidas, ou "componentes ${equipment.prefixoMolde}" para ver as peças.</span>
      </div>
    </div>
  `;
  
  openModal(equipmentDetailModal);
}

/**
 * MOSTRA APENAS INFORMAÇÕES DIMENSIONAIS
 */
function showDimensionalDetails(equipment) {
  equipmentDetailContent.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center; background: var(--light); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
      <div>
        <h3 style="margin: 0; color: var(--text-primary);">${equipment.prefixoMolde || 'N/A'} - Dimensões</h3>
        <p style="margin: 5px 0 0; color: var(--text-secondary);">Comando de Voz: Dimensional</p>
      </div>
      <div style="text-align: right;">
        <div style="font-size: 1rem; font-weight: 700; color: #e74c3c">DIMENSÕES</div>
        <p style="margin: 5px 0 0; color: var(--text-secondary);">Informação Específica</p>
      </div>
    </div>
    
    <div class="detail-grid">
      <div class="detail-section-title">Dimensional do Gargalo (mm)</div>
      
      <div class="detail-group">
        <span class="detail-label">Tolerância - (Mínimo):</span>
        <span class="detail-value" style="font-weight:600;color:#c0392b">${equipment.diametroGargaloMenos || 'Não especificado'} mm</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Ideal (Alvo):</span>
        <span class="detail-value" style="font-weight:600;color:#27ae60">${equipment.diametroGargaloIdeal || 'Não especificado'} mm</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Tolerância + (Máximo):</span>
        <span class="detail-value" style="font-weight:600;color:#c0392b">${equipment.diametroGargaloMais || 'Não especificado'} mm</span>
      </div>
      
      <div class="detail-section-title">Dimensional do Corpo (mm)</div>
      
      <div class="detail-group">
        <span class="detail-label">Tolerância - (Mínimo):</span>
        <span class="detail-value" style="font-weight:600;color:#c0392b">${equipment.diametroCorpoMenos || 'Não especificado'} mm</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Ideal (Alvo):</span>
        <span class="detail-value" style="font-weight:600;color:#27ae60">${equipment.diametroCorpoIdeal || 'Não especificado'} mm</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Tolerância + (Máximo):</span>
        <span class="detail-value" style="font-weight:600;color:#c0392b">${equipment.diametroCorpoMais || 'Não especificado'} mm</span>
      </div>
      
      <div class="detail-section-title">Equipamento</div>
      
      <div class="detail-group">
        <span class="detail-label">Prefixo Molde:</span>
        <span class="detail-value">${equipment.prefixoMolde || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Prefixo Blank:</span>
        <span class="detail-value">${equipment.prefixoBlank || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Processo:</span>
        <span class="detail-value">${equipment.processo || '-'}</span>
      </div>
      
      <div class="detail-group detail-full-width" style="background:#e8f4fd;border-left:4px solid #3498db">
        <span class="detail-label">💡 Dica de Voz:</span>
        <span class="detail-value">Tente dizer: "polimento ${equipment.prefixoMolde}" para ver como polir, ou "localização ${equipment.prefixoMolde}" para encontrar no almoxarifado.</span>
      </div>
    </div>
  `;
  
  openModal(equipmentDetailModal);
}

/**
 * MOSTRA APENAS COMPONENTES/TERMINAÇÕES
 */
function showComponentesDetails(equipment) {
  equipmentDetailContent.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center; background: var(--light); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
      <div>
        <h3 style="margin: 0; color: var(--text-primary);">${equipment.prefixoMolde || 'N/A'} - Componentes</h3>
        <p style="margin: 5px 0 0; color: var(--text-secondary);">Comando de Voz: Componentes</p>
      </div>
      <div style="text-align: right;">
        <div style="font-size: 1rem; font-weight: 700; color: #9b59b6">COMPONENTES</div>
        <p style="margin: 5px 0 0; color: var(--text-secondary);">Informação Específica</p>
      </div>
    </div>
    
    <div class="detail-grid">
      <div class="detail-section-title">Terminações Principais</div>
      
      <div class="detail-group">
        <span class="detail-label">Neckrings:</span>
        <span class="detail-value" style="font-weight:600">${equipment.neckrings || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Aneis Guias:</span>
        <span class="detail-value" style="font-weight:600">${equipment.aneisGuias || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Thimbles:</span>
        <span class="detail-value" style="font-weight:600">${equipment.thimble || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Machos:</span>
        <span class="detail-value" style="font-weight:600">${equipment.machos || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Coolers:</span>
        <span class="detail-value" style="font-weight:600">${equipment.coolers || '-'}</span>
      </div>
      
      <div class="detail-section-title">Componentes Internos</div>
      
      <div class="detail-group">
        <span class="detail-label">Baffles:</span>
        <span class="detail-value">${equipment.baffles || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Baffles Plugs:</span>
        <span class="detail-value">${equipment.bafflesPlugs || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Funis:</span>
        <span class="detail-value">${equipment.funis || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Fundos:</span>
        <span class="detail-value">${equipment.fundos || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Fundos Plugs:</span>
        <span class="detail-value">${equipment.fundosPlugs || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Sopradores:</span>
        <span class="detail-value">${equipment.sopradores || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Pinças:</span>
        <span class="detail-value">${equipment.pincas || '-'}</span>
      </div>
      
      <div class="detail-section-title">Equipamento</div>
      
      <div class="detail-group">
        <span class="detail-label">Prefixo Molde:</span>
        <span class="detail-value">${equipment.prefixoMolde || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Prefixo Blank:</span>
        <span class="detail-value">${equipment.prefixoBlank || '-'}</span>
      </div>
      
      <div class="detail-group detail-full-width" style="background:#e8f4fd;border-left:4px solid #3498db">
        <span class="detail-label">💡 Dica de Voz:</span>
        <span class="detail-value">Tente dizer: "polimento ${equipment.prefixoMolde}" ou "dimensional ${equipment.prefixoMolde}" para outras informações específicas.</span>
      </div>
    </div>
  `;
  
  openModal(equipmentDetailModal);
}

/**
 * MOSTRA APENAS LOCALIZAÇÃO NO ALMOXARIFADO
 */
function showLocalizacaoDetails(equipment) {
  equipmentDetailContent.innerHTML = `
    <div style="display: flex; justify-content: space-between; align-items: center; background: var(--light); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
      <div>
        <h3 style="margin: 0; color: var(--text-primary);">${equipment.prefixoMolde || 'N/A'} - Localização</h3>
        <p style="margin: 5px 0 0; color: var(--text-secondary);">Comando de Voz: Localização</p>
      </div>
      <div style="text-align: right;">
        <div style="font-size: 1rem; font-weight: 700; color: #f39c12">LOCALIZAÇÃO</div>
        <p style="margin: 5px 0 0; color: var(--text-secondary);">Informação Específica</p>
      </div>
    </div>
    
    <div class="detail-grid">
      <div class="detail-section-title">Localização no Almoxarifado</div>
      
      <div class="detail-group">
        <span class="detail-label">Corredor:</span>
        <span class="detail-value" style="font-size:1.2rem;font-weight:700;color:#e74c3c">${equipment.corredor || 'Não definido'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Prateleira:</span>
        <span class="detail-value" style="font-size:1.2rem;font-weight:700;color:#e74c3c">${equipment.prateleira || 'Não definida'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Almox. Molde:</span>
        <span class="detail-value" style="font-weight:600">${equipment.moldeAlmox || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Almox. Blank:</span>
        <span class="detail-value" style="font-weight:600">${equipment.blankAlmox || '-'}</span>
      </div>
      
      <div class="detail-section-title">Equipamento</div>
      
      <div class="detail-group">
        <span class="detail-label">Prefixo Molde:</span>
        <span class="detail-value">${equipment.prefixoMolde || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Prefixo Blank:</span>
        <span class="detail-value">${equipment.prefixoBlank || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Processo:</span>
        <span class="detail-value">${equipment.processo || '-'}</span>
      </div>
      
      <div class="detail-group">
        <span class="detail-label">Status:</span>
        <span class="detail-value">${equipment.status === 'production' ? 'Em produção' : equipment.status === 'sample' ? 'Amostra' : 'Fora de produção'}</span>
      </div>
      
      <div class="detail-group detail-full-width" style="background:#fff8e1;border-left:4px solid #f39c12">
        <span class="detail-label">📍 Localização Física:</span>
        <span class="detail-value">Encontre este equipamento no <strong>Corredor ${equipment.corredor || '?'}</strong>, <strong>Prateleira ${equipment.prateleira || '?'}</strong></span>
      </div>
      
      <div class="detail-group detail-full-width" style="background:#e8f4fd;border-left:4px solid #3498db">
        <span class="detail-label">💡 Dica de Voz:</span>
        <span class="detail-value">Tente dizer: "componentes ${equipment.prefixoMolde}" para ver as peças, ou "polimento ${equipment.prefixoMolde}" para instruções de polir.</span>
      </div>
    </div>
  `;
  
  openModal(equipmentDetailModal);
}

// Renomeia a função original para manter compatibilidade
function showEquipmentFullDetails(equipment) {
  showEquipmentDetails(equipment);
}
    /**
     * ENCONTRA UM EQUIPAMENTO PELO PREFIXO (MOLDE OU BLANK)
     * @param {string} prefix - Prefixo a ser buscado
     * @returns {Object|null} - Equipamento encontrado ou null
     */
    function findEquipmentByPrefix(prefix) {
      return equipmentData.find(eq => 
        (eq.prefixoMolde && eq.prefixoMolde.toUpperCase() === prefix) ||
        (eq.prefixoBlank && eq.prefixoBlank.toUpperCase() === prefix)
      );
    }

    /**
     * EXIBE DETALHES DO EQUIPAMENTO NO MODAL
     * @param {Object} equipment - Equipamento a ser exibido
     */
    function showEquipmentDetails(equipment) {
      const statusText = equipment.status === 'production' ? 'Em produção' : 
                        equipment.status === 'sample' ? 'Amostra' : 'Fora de produção';
      
      const statusColor = equipment.status === 'production' ? '#27ae60' : 
                         equipment.status === 'sample' ? '#f39c12' : '#c0392b';
      
      equipmentDetailContent.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; background: var(--light); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <div>
            <h3 style="margin: 0; color: var(--text-primary);">${equipment.prefixoMolde || 'N/A'}</h3>
            <p style="margin: 5px 0 0; color: var(--text-secondary);">Prefixo Molde</p>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 1.2rem; font-weight: 700; color: ${statusColor}">${statusText}</div>
            <p style="margin: 5px 0 0; color: var(--text-secondary);">Status</p>
          </div>
        </div>
        
        <div class="detail-grid">
          <div class="detail-section-title">Informações Básicas</div>
          
          <div class="detail-group">
            <span class="detail-label">Prefixo Blank:</span>
            <span class="detail-value">${equipment.prefixoBlank || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Processo:</span>
            <span class="detail-value">${equipment.processo || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Classe:</span>
            <span class="detail-value">${equipment.classe || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Almox. Molde:</span>
            <span class="detail-value">${equipment.moldeAlmox || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Almox. Blank:</span>
            <span class="detail-value">${equipment.blankAlmox || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Corredor:</span>
            <span class="detail-value">${equipment.corredor || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Prateleira:</span>
            <span class="detail-value">${equipment.prateleira || '-'}</span>
          </div>
          
          <div class="detail-section-title">Terminações</div>
          
          <div class="detail-group">
            <span class="detail-label">Neckrings:</span>
            <span class="detail-value">${equipment.neckrings || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Aneis Guias:</span>
            <span class="detail-value">${equipment.aneisGuias || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Thimbles:</span>
            <span class="detail-value">${equipment.thimble || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Machos:</span>
            <span class="detail-value">${equipment.machos || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Coolers:</span>
            <span class="detail-value">${equipment.coolers || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Baffles:</span>
            <span class="detail-value">${equipment.baffles || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Baffles Plugs:</span>
            <span class="detail-value">${equipment.bafflesPlugs || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Funis:</span>
            <span class="detail-value">${equipment.funis || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Fundos:</span>
            <span class="detail-value">${equipment.fundos || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Fundos Plugs:</span>
            <span class="detail-value">${equipment.fundosPlugs || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Sopradores:</span>
            <span class="detail-value">${equipment.sopradores || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Pinças:</span>
            <span class="detail-value">${equipment.pincas || '-'}</span>
          </div>
          
          <div class="detail-section-title">Informações Técnicas</div>
          
          <div class="detail-group">
            <span class="detail-label">Polimento Molde:</span>
            <span class="detail-value">${equipment.polimentoMolde || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Polimento Blank:</span>
            <span class="detail-value">${equipment.polimentoBlank || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Dimensional Gargalo (mm):</span>
            <span class="detail-value">Menos: ${equipment.diametroGargaloMenos || '-'} | Ideal: ${equipment.diametroGargaloIdeal || '-'} | Mais: ${equipment.diametroGargaloMais || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Dimensional Corpo (mm):</span>
            <span class="detail-value">Menos: ${equipment.diametroCorpoMenos || '-'} | Ideal: ${equipment.diametroCorpoIdeal || '-'} | Mais: ${equipment.diametroCorpoMais || '-'}</span>
          </div>
          
          ${equipment.observacoesTopo ? `
          <div class="detail-group detail-full-width">
            <span class="detail-label">Observações:</span>
            <span class="detail-value">${equipment.observacoesTopo}</span>
          </div>
          ` : ''}
          
          ${equipment.observacaoAjustagem ? `
          <div class="detail-group detail-full-width">
            <span class="detail-label">Observações de Ajustagem:</span>
            <span class="detail-value">${equipment.observacaoAjustagem}</span>
          </div>
          ` : ''}
          
          ${equipment.causasTroca ? `
          <div class="detail-group detail-full-width">
            <span class="detail-label">Causas de Troca:</span>
            <span class="detail-value">${equipment.causasTroca}</span>
          </div>
          ` : ''}
          
          ${equipment.observacoesAdicionais ? `
          <div class="detail-group detail-full-width">
            <span class="detail-label">Observações Adicionais:</span>
            <span class="detail-value">${equipment.observacoesAdicionais}</span>
          </div>
          ` : ''}
        </div>
      `;
      
      openModal(equipmentDetailModal);
    }

    // ===================================================================
    // SISTEMA DE IA DE VOZ - FUNÇÕES PRINCIPAIS
    // ===================================================================

    /**
     * FAZ A IA FALAR UM TEXTO USANDO WEB SPEECH API
     * @param {string} text - Texto a ser falado
     * @param {number} rate - Velocidade da fala (0.1 a 10)
     * @param {number} pitch - Tom da voz (0 a 2)
     */
    function speak(text, rate = 1.0, pitch = 1.0) {
      // Verifica se o navegador suporta síntese de voz
      if (!('speechSynthesis' in window)) {
        console.warn('Seu navegador não suporta síntese de voz.');
        return;
      }
      
      // Cria uma nova instância de SpeechSynthesisUtterance
      const utterance = new SpeechSynthesisUtterance(text);
      
      // Configurações da voz
      utterance.lang = 'pt-BR';
      utterance.rate = rate;
      utterance.pitch = pitch;
      utterance.volume = 0.8;
      
      // Tenta usar uma voz em português se disponível
      const voices = speechSynthesis.getVoices();
      const portugueseVoice = voices.find(voice => 
        voice.lang.includes('pt') || voice.lang.includes('PT')
      );
      
      if (portugueseVoice) {
        utterance.voice = portugueseVoice;
      }
      
      // Evento quando a fala termina
      utterance.onend = function() {
        console.log('Fala concluída:', text);
      };
      
      // Evento em caso de erro
      utterance.onerror = function(event) {
        console.error('Erro na síntese de voz:', event);
      };
      
      // Inicia a fala
      speechSynthesis.speak(utterance);
    }

    // ===================================================================
    // CONFIGURAÇÃO DOS EVENT LISTENERS PARA VOZ
    // ===================================================================

    // Botão de busca por voz
    voiceSearchButton.addEventListener('click', startVoiceRecognition);

    // ===================================================================
    // SISTEMA DE VÍDEOS - CORRIGIDO
    // ===================================================================

    /**
     * RENDERIZA A LISTA DE VÍDEOS NA GRADE
     * @param {Array} list - Array de vídeos a serem renderizados
     */
    function renderVideos(list) {
      console.log(`Renderizando ${list ? list.length : 0} vídeos`);
      videoGrid.innerHTML = '';
      
      if (!list || list.length === 0) {
        videoGrid.innerHTML = '<div style="grid-column:1/-1;padding:20px;background:var(--card-bg);border-radius:12px;text-align:center">Nenhum vídeo encontrado.</div>';
        document.getElementById('totalVideos').textContent = '0';
        return;
      }
      
      document.getElementById('totalVideos').textContent = list.length;
      
      list.forEach(video => {
        const card = document.createElement('div');
        card.className = 'video-card';
        
        // Determina se é um vídeo incorporado (YouTube/Vimeo) ou arquivo MP4
        const isEmbed = video.url.includes('youtube.com/embed') || 
                       video.url.includes('player.vimeo.com') ||
                       video.url.includes('youtu.be');
        
        // Verifica se é um link do GitHub (raw.githubusercontent.com)
        const isGitHubRaw = video.url.includes('raw.githubusercontent.com');
        
        const videoHtml = isEmbed 
          ? `<div class="video-iframe"><iframe src="${video.url}" allowfullscreen></iframe></div>`
          : `<div class="video-iframe"><video controls style="width:100%;height:220px;border-radius:12px;"><source src="${video.url}" type="video/mp4">Seu navegador não suporta vídeos.</video></div>`;
        
        card.innerHTML = `
          <h3>${escapeHtml(video.titulo)}</h3>
          ${videoHtml}
          <p>${escapeHtml(video.descricao || '')}</p>
          <div class="video-actions">
            <button class="edit-btn" data-id="${video.id}"><i class="fas fa-edit"></i> Editar</button>
            <button class="delete-btn" data-id="${video.id}"><i class="fas fa-trash"></i> Excluir</button>
          </div>
        `;
        
        videoGrid.appendChild(card);
      });
      
      // Configura os botões de ação nos vídeos
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          openEditVideoModal(id);
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const id = btn.getAttribute('data-id');
          
          // Solicita a senha de administrador
          const senha = prompt('Digite a senha de autorização para excluir vídeo:');
          if (String(senha || '').trim() !== String(ADMIN_PASSWORD || '').trim()) {
            alert('Senha incorreta. Exclusão cancelada.');
            return;
          }
          
          if (!confirm('Tem certeza que deseja excluir este vídeo?')) return;
          
          try {
            // Exclui o vídeo do Firestore
            await deleteVideoFromFirestore(id);
            showNotification('Vídeo excluído com sucesso!');
          } catch (err) {
            console.error(err);
            showNotification('Erro ao excluir vídeo. Verifique o console.', 'error');
          }
        });
      });
    }
    
    /**
     * ABRE O MODAL DE EDIÇÃO DE VÍDEO
     * @param {string} id - ID do vídeo a ser editado
     */
    function openEditVideoModal(id) {
      const video = videoData.find(v => v.id === id);
      if (!video) return;
      
      // Solicita a senha de administrador
      const senha = prompt('Digite a senha de autorização para editar vídeo:');
      if (String(senha || '').trim() !== String(ADMIN_PASSWORD || '').trim()) {
        alert('Senha incorreta. Operação cancelada.');
        return;
      }
      
      // Preenche o formulário com os dados do vídeo
      document.getElementById('editVideoId').value = video.id;
      document.getElementById('editVideoTitulo').value = video.titulo;
      document.getElementById('editVideoDescricao').value = video.descricao || '';
      document.getElementById('editVideoUrl').value = video.url;
      document.getElementById('editVideoThumbnail').value = video.thumbnail || '';
      
      // Abre o modal de edição
      openModal(editVideoModal);
    }

    // ===================================================================
    // NAVEGAÇÃO POR ABAS
    // ===================================================================

    // Captura os elementos das abas
    const tabEquip = document.getElementById('tabEquip');
    const tabVideos = document.getElementById('tabVideos');
    const tabContato = document.getElementById('tabContato');
    const tabContentEquip = document.getElementById('tabContentEquip');
    const tabContentVideos = document.getElementById('tabContentVideos');
    const tabContentContato = document.getElementById('tabContentContato');

    /**
     * CONFIGURA A NAVEGAÇÃO POR ABAS
     */
    function setupTabNavigation() {
      // Aba de Equipamentos
      tabEquip.addEventListener('click', () => {
        tabEquip.classList.add('active');
        tabVideos.classList.remove('active');
        tabContato.classList.remove('active');
        tabContentEquip.classList.add('active');
        tabContentVideos.classList.remove('active');
        tabContentContato.classList.remove('active');
      });
      
      // Aba de Vídeos
      tabVideos.addEventListener('click', () => {
        tabVideos.classList.add('active');
        tabEquip.classList.remove('active');
        tabContato.classList.remove('active');
        tabContentVideos.classList.add('active');
        tabContentEquip.classList.remove('active');
        tabContentContato.classList.remove('active');
      });
      
      // Aba de Contato
      tabContato.addEventListener('click', () => {
        tabContato.classList.add('active');
        tabEquip.classList.remove('active');
        tabVideos.classList.remove('active');
        tabContentContato.classList.add('active');
        tabContentEquip.classList.remove('active');
        tabContentVideos.classList.remove('active');
      });
    }

    // ===================================================================
    // INICIALIZAÇÃO DO FIREBASE - CORRIGIDA
    // ===================================================================

    /**
     * INICIALIZA A CONEXÃO COM O FIREBASE FIRESTORE
     */
    function initFirebase() {
      try {
        console.log('Inicializando Firebase...');
        
        // Verifica se o Firebase já foi inicializado
        if (!firebase.apps.length) {
          // Inicializa o Firebase com as configurações
          firebase.initializeApp(firebaseConfig);
        }
        
        db = firebase.firestore();
        useFirestore = true;
        console.log('Firebase inicializado com sucesso!');
        
        // Configura o listener em tempo real para equipamentos
        const equipmentRef = db.collection('equipments_v1');
        
        unsubEquipmentSnapshot = equipmentRef.onSnapshot((snapshot) => {
          console.log('Snapshot de equipamentos recebido:', snapshot.size, 'documentos');
          equipmentData = [];
          snapshot.forEach(doc => {
            equipmentData.push({ id: doc.id, ...doc.data() });
          });
          
          // Ordena por data de criação (mais recentes primeiro)
          equipmentData.sort((a, b) => (b.criadoEm || '').localeCompare(a.criadoEm || ''));
          renderEquipment(getCurrentPageData());
          showNotification(`Equipamentos carregados: ${equipmentData.length}`);
          
          // IA de Voz: Anuncia o carregamento
          if (equipmentData.length > 0) {
            speak(`Sistema conectado. ${equipmentData.length} equipamentos carregados.`);
          }
        }, (error) => {
          console.error('Erro no Firestore (equipamentos):', error);
          showNotification('Erro ao carregar equipamentos', 'error');
          speak('Erro ao conectar com a base de dados de equipamentos.');
          // Tenta carregar do localStorage em caso de erro
          loadLocal();
        });
        
        // Configura o listener em tempo real para vídeos
        const videosRef = db.collection('videos_v1');
        
        unsubVideoSnapshot = videosRef.onSnapshot((snapshot) => {
          console.log('Snapshot de vídeos recebido:', snapshot.size, 'documentos');
          videoData = [];
          snapshot.forEach(doc => {
            videoData.push({ id: doc.id, ...doc.data() });
          });
          
          // Ordena por data de criação (mais recentes primeiro)
          videoData.sort((a, b) => (b.criadoEm || '').localeCompare(a.criadoEm || ''));
          renderVideos(videoData);
        }, (error) => {
          console.error('Erro no Firestore (vídeos):', error);
          showNotification('Erro ao carregar vídeos', 'error');
          // Tenta carregar do localStorage em caso de erro
          loadLocal();
        });
        
      } catch (error) {
        console.error('Erro ao inicializar Firebase:', error);
        showNotification('Erro ao conectar com Firebase', 'error');
        useFirestore = false;
        // Carrega dados locais
        loadLocal();
        
        // IA de Voz: Avisa sobre o fallback para localStorage
        speak('Sistema operando em modo offline. Os dados serão salvos localmente.');
      }
    }

    /**
     * CARREGA OS DADOS DO LOCALSTORAGE (FALLBACK)
     */
    function loadLocal() {
      console.log('Carregando dados do localStorage...');
      const storedEquipment = localStorage.getItem('equipmentData');
      const storedVideos = localStorage.getItem('videoData');
      
      if (storedEquipment) {
        equipmentData = JSON.parse(storedEquipment);
        renderEquipment(getCurrentPageData());
        showNotification(`Equipamentos carregados do localStorage: ${equipmentData.length}`);
      }
      
      if (storedVideos) {
        videoData = JSON.parse(storedVideos);
        renderVideos(videoData);
      }
    }

    /**
     * SALVA OS DADOS NO LOCALSTORAGE (FALLBACK)
     */
    function persistLocal() {
      console.log('Persistindo dados no localStorage...');
      localStorage.setItem('equipmentData', JSON.stringify(equipmentData));
      localStorage.setItem('videoData', JSON.stringify(videoData));
    }

    // ===================================================================
    // FUNÇÕES DO FIREBASE FIRESTORE - CORRIGIDAS
    // ===================================================================

    /**
     * ADICIONA UM NOVO EQUIPAMENTO AO FIRESTORE
     * @param {Object} equipment - Dados do equipamento
     */
    async function addEquipmentToFirestore(equipment) {
      if (!db) throw new Error('Firestore não inicializado');
      
      // Adiciona timestamp de criação
      equipment.criadoEm = new Date().toISOString();
      
      // Adiciona ao Firestore
      const docRef = await db.collection('equipments_v1').add(equipment);
      console.log('Equipamento adicionado com ID:', docRef.id);
      
      return docRef.id;
    }

    /**
     * ATUALIZA UM EQUIPAMENTO NO FIRESTORE
     * @param {string} id - ID do equipamento
     * @param {Object} equipment - Dados atualizados do equipamento
     */
    async function updateEquipmentInFirestore(id, equipment) {
      if (!db) throw new Error('Firestore não inicializado');
      
      await db.collection('equipments_v1').doc(id).update(equipment);
      console.log('Equipamento atualizado:', id);
    }

    /**
     * EXCLUI UM EQUIPAMENTO DO FIRESTORE
     * @param {string} id - ID do equipamento
     */
    async function deleteEquipmentFromFirestore(id) {
      if (!db) throw new Error('Firestore não inicializado');
      
      await db.collection('equipments_v1').doc(id).delete();
      console.log('Equipamento excluído:', id);
    }

    /**
     * ADICIONA UM NOVO VÍDEO AO FIRESTORE
     * @param {Object} video - Dados do vídeo
     */
    async function addVideoToFirestore(video) {
      if (!db) throw new Error('Firestore não inicializado');
      
      // Adiciona timestamp de criação
      video.criadoEm = new Date().toISOString();
      
      // Adiciona ao Firestore
      const docRef = await db.collection('videos_v1').add(video);
      console.log('Vídeo adicionado com ID:', docRef.id);
      
      return docRef.id;
    }

    /**
     * ATUALIZA UM VÍDEO NO FIRESTORE
     * @param {string} id - ID do vídeo
     * @param {Object} video - Dados atualizados do vídeo
     */
    async function updateVideoInFirestore(id, video) {
      if (!db) throw new Error('Firestore não inicializado');
      
      await db.collection('videos_v1').doc(id).update(video);
      console.log('Vídeo atualizado:', id);
    }

    /**
     * EXCLUI UM VÍDEO DO FIRESTORE
     * @param {string} id - ID do vídeo
     */
    async function deleteVideoFromFirestore(id) {
      if (!db) throw new Error('Firestore não inicializado');
      
      await db.collection('videos_v1').doc(id).delete();
      console.log('Vídeo excluído:', id);
    }

    // ===================================================================
    // FUNÇÕES DE MANIPULAÇÃO DE FORMULÁRIOS - CORRIGIDAS
    // ===================================================================

    /**
     * ABRE O MODAL DE ADIÇÃO DE EQUIPAMENTO
     */
    function openAddModal() {
      // Solicita a senha de administrador
      const senha = prompt('Digite a senha de autorização para adicionar equipamento:');
      if (String(senha || '').trim() !== String(ADMIN_PASSWORD || '').trim()) {
        alert('Senha incorreta. Operação cancelada.');
        return;
      }
      
      // Limpa o formulário
      addForm.reset();
      imagePreview.innerHTML = '';
      openModal(addModal);
    }

    /**
     * ABRE O MODAL DE EDIÇÃO DE EQUIPAMENTO
     * @param {string} id - ID do equipamento a ser editado
     */
    function openEditModal(id) {
      // Solicita a senha de administrador
      const senha = prompt('Digite a senha de autorização para editar equipamento:');
      if (String(senha || '').trim() !== String(ADMIN_PASSWORD || '').trim()) {
        alert('Senha incorreta. Operação cancelada.');
        return;
      }
      
      const eq = equipmentData.find(x => x.id === id);
      if (!eq) return;
      
      // Preenche o formulário com os dados do equipamento
      document.getElementById('editId').value = eq.id;
      document.getElementById('editPrefixoMolde').value = eq.prefixoMolde || '';
      document.getElementById('editPrefixoBlank').value = eq.prefixoBlank || '';
      document.getElementById('editProcesso').value = eq.processo || '';
      document.getElementById('editClasse').value = eq.classe || '';
      document.getElementById('editNeckrings').value = eq.neckrings || '';
      document.getElementById('editAneisGuias').value = eq.aneisGuias || '';
      document.getElementById('editThimble').value = eq.thimble || '';
      document.getElementById('editMachos').value = eq.machos || '';
      document.getElementById('editCoolers').value = eq.coolers || '';
      document.getElementById('editBaffles').value = eq.baffles || '';
      document.getElementById('editBafflesPlugs').value = eq.bafflesPlugs || '';
      document.getElementById('editFunis').value = eq.funis || '';
      document.getElementById('editFundos').value = eq.fundos || '';
      document.getElementById('editFundosPlugs').value = eq.fundosPlugs || '';
      document.getElementById('editSopradores').value = eq.sopradores || '';
      document.getElementById('editPincas').value = eq.pincas || '';
      document.getElementById('editMoldeAlmox').value = eq.moldeAlmox || '';
      document.getElementById('editBlankAlmox').value = eq.blankAlmox || '';
      document.getElementById('editCorredor').value = eq.corredor || '';
      document.getElementById('editPrateleira').value = eq.prateleira || '';
      document.getElementById('editObservacoesTopo').value = eq.observacoesTopo || '';
      document.getElementById('editPolimentoMolde').value = eq.polimentoMolde || '';
      document.getElementById('editPolimentoBlank').value = eq.polimentoBlank || '';
      
document.getElementById('editGrafiteMolde').value = eq.grafiteMolde || '';

document.getElementById('editGrafiteBlank').value = eq.grafiteBlank || '';

document.getElementById('editGrafiteFundo').value = eq.grafiteFundo || '';

document.getElementById('editGrafiteFunil').value = eq.grafiteFunil || '';
      document.getElementById('editObservacaoAjustagem').value = eq.observacaoAjustagem || '';
      document.getElementById('editCausasTroca').value = eq.causasTroca || '';
      document.getElementById('editDiametroGargaloMenos').value = eq.diametroGargaloMenos || '';
      document.getElementById('editDiametroGargaloIdeal').value = eq.diametroGargaloIdeal || '';
      document.getElementById('editDiametroGargaloMais').value = eq.diametroGargaloMais || '';
      document.getElementById('editDiametroCorpoMenos').value = eq.diametroCorpoMenos || '';
      document.getElementById('editDiametroCorpoIdeal').value = eq.diametroCorpoIdeal || '';
      document.getElementById('editDiametroCorpoMais').value = eq.diametroCorpoMais || '';
      document.getElementById('editObservacoesAdicionais').value = eq.observacoesAdicionais || '';
      document.getElementById('editStatus').value = eq.status || 'production';
      document.getElementById('editUrlImg1').value = eq.urlImg1 || '';
      document.getElementById('editUrlImg2').value = eq.urlImg2 || '';
      
      document.getElementById('editLinkImg1').value = eq.linkImg1 || '';
      
document.getElementById('editLinkImg2').value = eq.linkImg2 || '';
      
      // Atualiza o preview das imagens
      updateImagePreview('editImagePreview', eq.urlImg1, eq.urlImg2);
      
      openModal(editModal);
    }

    /**
     * ABRE O MODAL DE VISUALIZAÇÃO DE EQUIPAMENTO
     * @param {string} id - ID do equipamento a ser visualizado
     */
    function openViewModal(id) {
      const eq = equipmentData.find(x => x.id === id);
      if (!eq) return;
      
      // Gera o HTML para visualização detalhada
      const statusText = eq.status === 'production' ? 'Em produção' : 
                        eq.status === 'sample' ? 'Amostra' : 'Fora de produção';
      
      const statusColor = eq.status === 'production' ? '#27ae60' : 
                         eq.status === 'sample' ? '#f39c12' : '#c0392b';
      
      // Gera o HTML das imagens com links clicáveis
let imgHtml = '';
if (eq.urlImg1 || eq.urlImg2) {
  imgHtml = '<div style="display: flex; gap: 10px; margin-bottom: 20px;">';
  
  if (eq.urlImg1) {
    if (eq.linkImg1) {
      // Se tem link, coloca a imagem dentro de um link clicável
      imgHtml += `<a href="${eq.linkImg1}" target="_blank" style="text-decoration: none;">
        <img src="${eq.urlImg1}" alt="Imagem 1" style="max-width: 100%; max-height: 300px; border-radius: 8px; cursor: pointer; border: 2px solid #3498db; transition: border-color 0.3s ease;">
        <div style="text-align: center; margin-top: 5px; font-size: 0.8rem; color: #3498db;">🔗 Clique para abrir link</div>
      </a>`;
    } else {
      // Se não tem link, mostra apenas a imagem
      imgHtml += `<img src="${eq.urlImg1}" alt="Imagem 1" style="max-width: 100%; max-height: 100px; border-radius: 8px;">`;
    }
  }
  
  if (eq.urlImg2) {
    if (eq.linkImg2) {
      // Se tem link, coloca a imagem dentro de um link clicável
      imgHtml += `<a href="${eq.linkImg2}" target="_blank" style="text-decoration: none;">
        <img src="${eq.urlImg2}" alt="Imagem 2" style="max-width: 100%; max-height: 300px; border-radius: 8px; cursor: pointer; border: 2px solid #3498db; transition: border-color 0.3s ease;">
        <div style="text-align: center; margin-top: 5px; font-size: 0.8rem; color: #3498db;">🔗 Clique para abrir mais detalhes</div>
      </a>`;
    } else {
      // Se não tem link, mostra apenas a imagem
      imgHtml += `<img src="${eq.urlImg2}" alt="Imagem 2" style="max-width: 100%; max-height: 100px; border-radius: 8px;">`;
    }
  }
  
  imgHtml += '</div>';
}
      
      viewModalContent.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; background: var(--light); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <div>
            <h3 style="margin: 0; color: var(--text-primary);">${eq.prefixoMolde || 'N/A'}</h3>
            <p style="margin: 5px 0 0; color: var(--text-secondary);">Prefixo Molde</p>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 1.2rem; font-weight: 700; color: ${statusColor}">${statusText}</div>
            <p style="margin: 5px 0 0; color: var(--text-secondary);">Status</p>
          </div>
        </div>
        
        ${imgHtml}
        
        <div class="detail-grid">
          <div class="detail-section-title">Informações Básicas</div>
          
          <div class="detail-group">
            <span class="detail-label">Prefixo Blank:</span>
            <span class="detail-value">${eq.prefixoBlank || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Processo:</span>
            <span class="detail-value">${eq.processo || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Classe:</span>
            <span class="detail-value">${eq.classe || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Almox. Molde:</span>
            <span class="detail-value">${eq.moldeAlmox || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Almox. Blank:</span>
            <span class="detail-value">${eq.blankAlmox || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Corredor:</span>
            <span class="detail-value">${eq.corredor || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Prateleira:</span>
            <span class="detail-value">${eq.prateleira || '-'}</span>
          </div>
          
          <div class="detail-section-title">Terminações</div>
          
          <div class="detail-group">
            <span class="detail-label">Neckrings:</span>
            <span class="detail-value">${eq.neckrings || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Aneis Guias:</span>
            <span class="detail-value">${eq.aneisGuias || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Thimbles:</span>
            <span class="detail-value">${eq.thimble || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Machos:</span>
            <span class="detail-value">${eq.machos || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Coolers:</span>
            <span class="detail-value">${eq.coolers || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Baffles:</span>
            <span class="detail-value">${eq.baffles || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Baffles Plugs:</span>
            <span class="detail-value">${eq.bafflesPlugs || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Funis:</span>
            <span class="detail-value">${eq.funis || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Fundos:</span>
            <span class="detail-value">${eq.fundos || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Fundos Plugs:</span>
            <span class="detail-value">${eq.fundosPlugs || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Sopradores:</span>
            <span class="detail-value">${eq.sopradores || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Pinças:</span>
            <span class="detail-value">${eq.pincas || '-'}</span>
          </div>
          
          <div class="detail-section-title">Informações Técnicas</div>
          
          <div class="detail-group">
            <span class="detail-label">Polimento Molde:</span>
            <span class="detail-value">${eq.polimentoMolde || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Polimento Blank:</span>
            <span class="detail-value">${eq.polimentoBlank || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Dimensional Gargalo (mm):</span>
            <span class="detail-value">Menos: ${eq.diametroGargaloMenos || '-'} | Ideal: ${eq.diametroGargaloIdeal || '-'} | Mais: ${eq.diametroGargaloMais || '-'}</span>
          </div>
          
          <div class="detail-group">
            <span class="detail-label">Dimensional Corpo (mm):</span>
            <span class="detail-value">Menos: ${eq.diametroCorpoMenos || '-'} | Ideal: ${eq.diametroCorpoIdeal || '-'} | Mais: ${eq.diametroCorpoMais || '-'}</span>
          </div>
          
          <div class="detail-section-title">Grafite</div>

<div class="detail-group">
  <span class="detail-label">Molde:</span>
  <span class="detail-value">${eq.grafiteMolde || '-'}</span>
</div>

<div class="detail-group">
  <span class="detail-label">Blank:</span>
  <span class="detail-value">${eq.grafiteBlank || '-'}</span>
</div>

<div class="detail-group">
  <span class="detail-label">Fundo:</span>
  <span class="detail-value">${eq.grafiteFundo || '-'}</span>
</div>

<div class="detail-group">
  <span class="detail-label">Funil:</span>
  <span class="detail-value">${eq.grafiteFunil || '-'}</span>
</div>
          
          ${eq.observacoesTopo ? `
          <div class="detail-group detail-full-width">
            <span class="detail-label">Observações:</span>
            <span class="detail-value">${eq.observacoesTopo}</span>
          </div>
          ` : ''}
          
          ${eq.observacaoAjustagem ? `
          <div class="detail-group detail-full-width">
            <span class="detail-label">Observações de Ajustagem:</span>
            <span class="detail-value">${eq.observacaoAjustagem}</span>
          </div>
          ` : ''}
          
          ${eq.causasTroca ? `
          <div class="detail-group detail-full-width">
            <span class="detail-label">Causas de Troca:</span>
            <span class="detail-value">${eq.causasTroca}</span>
          </div>
          ` : ''}
          
          ${eq.observacoesAdicionais ? `
          <div class="detail-group detail-full-width">
            <span class="detail-label">Observações Adicionais:</span>
            <span class="detail-value">${eq.observacoesAdicionais}</span>
          </div>
          ` : ''}
        </div>
      `;
      
      openModal(viewModal);
    }

    /**
     * ATUALIZA O PREVIEW DAS IMAGENS NOS FORMULÁRIOS
     * @param {string} containerId - ID do container de preview
     * @param {string} img1 - URL da imagem 1
     * @param {string} img2 - URL da imagem 2
     */
    function updateImagePreview(containerId, img1, img2) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      
      if (img1) {
        const imgEl1 = document.createElement('img');
        imgEl1.src = img1;
        imgEl1.onerror = () => imgEl1.style.display = 'none';
        container.appendChild(imgEl1);
      }
      
      if (img2) {
        const imgEl2 = document.createElement('img');
        imgEl2.src = img2;
        imgEl2.onerror = () => imgEl2.style.display = 'none';
        container.appendChild(imgEl2);
      }
    }

    // ===================================================================
    // EVENT LISTENERS DOS FORMULÁRIOS
    // ===================================================================

    // Formulário de adição de equipamento
addForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  // Coleta o prefixo do molde
  const prefixoMolde = document.getElementById('addPrefixoMolde').value.trim();
  
  // Verifica se já existe equipamento com este prefixo
  if (checkExistingPrefix(prefixoMolde)) {
      const confirmar = confirm(`⚠️ ATENÇÃO: Já existe um equipamento com o prefixo "${prefixoMolde}".\n\nDeseja continuar mesmo assim?`);
      if (!confirmar) {
          return; // Cancela o salvamento
      }
  }
  
  // Coleta os dados do formulário
  const equipment = {
    prefixoMolde: prefixoMolde,
    prefixoBlank: document.getElementById('addPrefixoBlank').value,
    
    processo: document.getElementById('addProcesso').value,
    
    classe: document.getElementById('addClasse').value,
    
    neckrings: document.getElementById('addNeckrings').value,
    
    aneisGuias: document.getElementById('addAneisGuias').value,
    
    thimble: document.getElementById('addThimble').value,
    
    machos: document.getElementById('addMachos').value,
    
    coolers: document.getElementById('addCoolers').value,
    
    baffles: document.getElementById('addBaffles').value,
    
    bafflesPlugs: document.getElementById('addBafflesPlugs').value,
    
    funis: document.getElementById('addFunis').value,
    
    fundos: document.getElementById('addFundos').value,
    
    fundosPlugs: document.getElementById('addFundosPlugs').value,
    
    sopradores: document.getElementById('addSopradores').value,
    
    pincas: document.getElementById('addPincas').value,
    
    moldeAlmox: document.getElementById('addMoldeAlmox').value,
    
    blankAlmox: document.getElementById('addBlankAlmox').value,
    
    corredor: document.getElementById('addCorredor').value,
    
    prateleira: document.getElementById('addPrateleira').value,
    
    observacoesTopo: document.getElementById('addObservacoesTopo').value,
    
    polimentoMolde: document.getElementById('addPolimentoMolde').value,
    
    polimentoBlank: document.getElementById('addPolimentoBlank').value,
    
    grafiteMolde: document.getElementById('addGrafiteMolde').value,
    
    grafiteBlank: document.getElementById('addGrafiteBlank').value,

    grafiteFundo: document.getElementById('addGrafiteFundo').value,

    grafiteFunil: document.getElementById('addGrafiteFunil').value,
      
    observacaoAjustagem: document.getElementById('addObservacaoAjustagem').value,
    
    causasTroca: document.getElementById('addCausasTroca').value,
    diametroGargaloMenos: document.getElementById('addDiametroGargaloMenos').value,
    
    diametroGargaloIdeal: document.getElementById('addDiametroGargaloIdeal').value,
    
    diametroGargaloMais: document.getElementById('addDiametroGargaloMais').value,
    
    diametroCorpoMenos: document.getElementById('addDiametroCorpoMenos').value,
    
    diametroCorpoIdeal: document.getElementById('addDiametroCorpoIdeal').value,
    
    diametroCorpoMais: document.getElementById('addDiametroCorpoMais').value,
    
    observacoesAdicionais: document.getElementById('addObservacoesAdicionais').value,
    
    status: document.getElementById('addStatus').value,
    
    urlImg1: document.getElementById('addUrlImg1').value,
    
    urlImg2: document.getElementById('addUrlImg2').value,
    
    linkImg1: document.getElementById('addLinkImg1').value,
    linkImg2: document.getElementById('addLinkImg2').value
    
  };
  
  try {
    if (useFirestore && db) {
      // Salva no Firestore
      await addEquipmentToFirestore(equipment);
    } else {
      // Salva localmente
      equipment.id = Date.now().toString();
      equipment.criadoEm = new Date().toISOString();
      equipmentData.push(equipment);
      persistLocal();
      renderEquipment(getCurrentPageData());
    }
    
    showNotification('Equipamento adicionado com sucesso!');
    closeModal(addModal);
  } catch (err) {
    console.error(err);
    showNotification('Erro ao adicionar equipamento. Verifique o console.', 'error');
  }
});

    // Formulário de edição de equipamento
editForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const id = document.getElementById('editId').value;
  const prefixoMolde = document.getElementById('editPrefixoMolde').value.trim();
  
  // Verifica se já existe outro equipamento com este prefixo (excluindo o atual)
  if (checkExistingPrefix(prefixoMolde, id)) {
      const confirmar = confirm(`⚠️ ATENÇÃO: Já existe OUTRO equipamento com o prefixo "${prefixoMolde}".\n\nDeseja continuar mesmo assim?`);
      if (!confirmar) {
          return; // Cancela a edição
      }
  }
  
  // Coleta os dados do formulário
  const equipment = {
    prefixoMolde: prefixoMolde,
    prefixoBlank: document.getElementById('editPrefixoBlank').value,
    processo: document.getElementById('editProcesso').value,
    classe: document.getElementById('editClasse').value,
    
    neckrings: document.getElementById('editNeckrings').value,
    aneisGuias: document.getElementById('editAneisGuias').value,
    thimble: document.getElementById('editThimble').value,
    machos: document.getElementById('editMachos').value,
    coolers: document.getElementById('editCoolers').value,
    baffles: document.getElementById('editBaffles').value,
    bafflesPlugs: document.getElementById('editBafflesPlugs').value,
    funis: document.getElementById('editFunis').value,
    fundos: document.getElementById('editFundos').value,
    fundosPlugs: document.getElementById('editFundosPlugs').value,
    sopradores: document.getElementById('editSopradores').value,
    pincas: document.getElementById('editPincas').value,
    moldeAlmox: document.getElementById('editMoldeAlmox').value,
    blankAlmox: document.getElementById('editBlankAlmox').value,
    corredor: document.getElementById('editCorredor').value,
    prateleira: document.getElementById('editPrateleira').value,
    observacoesTopo: document.getElementById('editObservacoesTopo').value,
    polimentoMolde: document.getElementById('editPolimentoMolde').value,
    polimentoBlank: document.getElementById('editPolimentoBlank').value,
    
    grafiteMolde: document.getElementById('editGrafiteMolde').value,
    
    grafiteBlank: document.getElementById('editGrafiteBlank').value,

    grafiteFundo: document.getElementById('editGrafiteFundo').value,

    grafiteFunil: document.getElementById('editGrafiteFunil').value,

    observacaoAjustagem: document.getElementById('editObservacaoAjustagem').value,
    
    causasTroca: document.getElementById('editCausasTroca').value,
    
    diametroGargaloMenos: document.getElementById('editDiametroGargaloMenos').value,
    
    diametroGargaloIdeal: document.getElementById('editDiametroGargaloIdeal').value,
    
    diametroGargaloMais: document.getElementById('editDiametroGargaloMais').value,
    
    diametroCorpoMenos: document.getElementById('editDiametroCorpoMenos').value,
    
    diametroCorpoIdeal: document.getElementById('editDiametroCorpoIdeal').value,
    
    diametroCorpoMais: document.getElementById('editDiametroCorpoMais').value,
    
    observacoesAdicionais: document.getElementById('editObservacoesAdicionais').value,
    
    status: document.getElementById('editStatus').value,
    urlImg1: document.getElementById('editUrlImg1').value,
    
    urlImg2: document.getElementById('editUrlImg2').value,
    
    linkImg1: document.getElementById('editLinkImg1').value,
    linkImg2: document.getElementById('editLinkImg2').value
    
  };
  
  try {
    if (useFirestore && db) {
      // Atualiza no Firestore
      await updateEquipmentInFirestore(id, equipment);
    } else {
      // Atualiza localmente
      const index = equipmentData.findIndex(x => x.id === id);
      if (index !== -1) {
        equipmentData[index] = { ...equipmentData[index], ...equipment };
        persistLocal();
        renderEquipment(getCurrentPageData());
      }
    }
    
    showNotification('Equipamento atualizado com sucesso!');
    closeModal(editModal);
  } catch (err) {
    console.error(err);
    showNotification('Erro ao atualizar equipamento. Verifique o console.', 'error');
  }
});

    // Formulário de edição de vídeo
    editVideoForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const id = document.getElementById('editVideoId').value;
      
      // Coleta os dados do formulário
      const video = {
        titulo: document.getElementById('editVideoTitulo').value,
        descricao: document.getElementById('editVideoDescricao').value,
        url: document.getElementById('editVideoUrl').value,
        thumbnail: document.getElementById('editVideoThumbnail').value
      };
      
      try {
        // Atualiza o vídeo no Firestore
        await updateVideoInFirestore(id, video);
        showNotification('Vídeo atualizado com sucesso!');
        closeModal(editVideoModal);
      } catch (err) {
        console.error(err);
        showNotification('Erro ao atualizar vídeo. Verifique o console.', 'error');
      }
    });

    // Botão de adicionar vídeo
    addVideoBtn.addEventListener('click', async () => {
      // Solicita a senha de administrador
      const senha = prompt('Digite a senha de autorização para adicionar vídeo:');
      if (String(senha || '').trim() !== String(ADMIN_PASSWORD || '').trim()) {
        alert('Senha incorreta. Operação cancelada.');
        return;
      }
      
      const titulo = document.getElementById('videoTitulo').value;
      const descricao = document.getElementById('videoDescricao').value;
      const url = document.getElementById('videoUrl').value;
      const thumbnail = document.getElementById('videoThumbnail').value;
      
      if (!titulo || !url) {
        alert('Título e URL são obrigatórios!');
        return;
      }
      
      try {
        const video = { titulo, descricao, url, thumbnail };
        
        // Adiciona o vídeo ao Firestore
        await addVideoToFirestore(video);
        
        // Limpa o formulário
        document.getElementById('videoTitulo').value = '';
        document.getElementById('videoDescricao').value = '';
        document.getElementById('videoUrl').value = '';
        document.getElementById('videoThumbnail').value = '';
        
        showNotification('Vídeo adicionado com sucesso!');
      } catch (err) {
        console.error(err);
        showNotification('Erro ao adicionar vídeo. Verifique o console.', 'error');
      }
    });

    // ===================================================================
    // FUNÇÕES UTILITÁRIAS ADICIONAIS
    // ===================================================================

    /**
     * ESCAPA CARACTERES ESPECIAIS HTML PARA PREVENIR XSS
     * @param {string} text - Texto a ser escapado
     * @returns {string} - Texto escapado
     */
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    /**
     * ATUALIZA O PREVIEW DAS IMAGENS AO DIGITAR AS URLS
     */
    function setupImagePreviewListeners() {
      // Preview para formulário de adição
      document.getElementById('addUrlImg1').addEventListener('input', () => {
        const img1 = document.getElementById('addUrlImg1').value;
        const img2 = document.getElementById('addUrlImg2').value;
        updateImagePreview('imagePreview', img1, img2);
      });
      
      document.getElementById('addUrlImg2').addEventListener('input', () => {
        const img1 = document.getElementById('addUrlImg1').value;
        const img2 = document.getElementById('addUrlImg2').value;
        updateImagePreview('imagePreview', img1, img2);
      });
      
      // Preview para formulário de edição
      document.getElementById('editUrlImg1').addEventListener('input', () => {
        const img1 = document.getElementById('editUrlImg1').value;
        const img2 = document.getElementById('editUrlImg2').value;
        updateImagePreview('editImagePreview', img1, img2);
      });
      
      document.getElementById('editUrlImg2').addEventListener('input', () => {
        const img1 = document.getElementById('editUrlImg1').value;
        const img2 = document.getElementById('editUrlImg2').value;
        updateImagePreview('editImagePreview', img1, img2);
      });
    }

    // ===================================================================
    // CONFIGURAÇÃO INICIAL DO SISTEMA
    // ===================================================================

    /**
     * INICIALIZA TODOS OS COMPONENTES DO SISTEMA
     */
    function init() {
  console.log('Iniciando sistema...');
  
  // Inicializa o tema
  initTheme();
  
  // Configura atalhos de teclado - ADICIONE ESTA LINHA
  setupKeyboardShortcuts();
  
  // Configura a navegação por abas
  setupTabNavigation();
      
      
      
      // Configura a navegação por abas
      setupTabNavigation();
      
      // Configura os listeners de preview de imagem
      setupImagePreviewListeners();
      
      // Configura os filtros de equipamentos
      filters.forEach(btn => {
        btn.addEventListener('click', () => {
          filters.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentFilter = btn.getAttribute('data-filter');
          currentPage = 1; // Volta para a primeira página ao mudar o filtro
          renderEquipment(getCurrentPageData());
        });
      });
      
      // Configura a busca por texto
      searchButton.addEventListener('click', () => {
        const query = searchInput.value.toLowerCase().trim();
        if (!query) {
          renderEquipment(getCurrentPageData());
          return;
        }
        
        const filtered = equipmentData.filter(eq => 
          (eq.prefixoMolde && eq.prefixoMolde.toLowerCase().includes(query)) ||
          (eq.prefixoBlank && eq.prefixoBlank.toLowerCase().includes(query)) ||
          (eq.processo && eq.processo.toLowerCase().includes(query))
        );
        
        renderEquipment(filtered);
      });
      
      // Configura a busca por voz inteligente
      aiSearchButton.addEventListener('click', () => {
        const query = aiSearchInput.value.trim().toUpperCase();
        if (!query) return;
        
        const equipment = findEquipmentByPrefix(query);
        
        if (equipment) {
          // Remove qualquer highlight anterior
          if (currentHighlightedEquipment) {
            const previousCard = document.querySelector(`[data-id="${currentHighlightedEquipment}"]`);
            if (previousCard) {
              previousCard.closest('.equipment-card').classList.remove('highlighted');
            }
            currentHighlightedEquipment = null;
          }
          
          // Destaca o equipamento na lista
          currentHighlightedEquipment = equipment.id;
          renderEquipment(getCurrentPageData());
          
          // Mostra informações detalhadas
          showEquipmentDetails(equipment);
          showNotification(`Mostrando informações do equipamento ${query}`);
        } else {
          showNotification(`Equipamento com prefixo ${query} não encontrado.`, 'error');
        }
      });
      
      // Configura a busca em vídeos
      videoSearch.addEventListener('input', () => {
        const query = videoSearch.value.toLowerCase().trim();
        if (!query) {
          renderVideos(videoData);
          return;
        }
        
        const filtered = videoData.filter(video => 
          video.titulo.toLowerCase().includes(query) ||
          (video.descricao && video.descricao.toLowerCase().includes(query))
        );
        
        renderVideos(filtered);
      });
      
      // Configura o botão de adicionar equipamento
      addButton.addEventListener('click', openAddModal);
      
      // Configura o modal de defeitos
      defectsButton.addEventListener('click', () => {
        openModal(defectsModal);
      });
      
      // Configura o seletor de defeitos
      // Configura o seletor de defeitos
defectSelect.addEventListener('change', () => {
  const selected = defectSelect.value;
  if (!selected) {
    defectInfo.style.display = 'none';
    return;
  }
  
  defectInfo.style.display = 'block';
  
  // Texto informativo sobre o defeito selecionado - USANDO TEMPLATE STRINGS
  const defectInfoText = {
  
    'Costura de Molde': `Molde aberto

Costura arredondada

Folga nas guias

Fundo apertado

Costura desencontrada

Encaixes amassados

Ausência de Roll Strip (consultar existência em projeto).`,



    'Costura de Blank': `Blank aberto

Costura arredondada

Folga das guias

Baffle apertado

Costura desencontrada

Neckring apertado

Encaixes amassados

Ausência de Roll Strip (consultar existência em projeto).`,




    'Frizo no Fundo': `Aresta do molde arredondada

Aresta do fundo arredondada

Fundo com excesso de folga

Cavidade do fundo negativa no molde

Pino de posicionamento com excesso de folga.`,



    'Marca de Baffle': `Arestas do blank arredondadas

Arestas do baffle arredondadas

Baffle apertado

Pino de posicionamento com folga.`,



    'Racho na Terminação': `Ø(Diametro) dos gargalos fora do especificado

Anéis de assentamento fora do especificado

Injetor muito próximo da altura da terminação

Travas de gargalo com interferência

Neckring apertado nos blanks

Fundo do molde apertado.`,




    'Racho na Trava': `Trava de gargalos com interferência

Trava do blank maior que a do molde

Trava do molde menor que a do blank
.`,




    'Dobra Aberta no Gargalo': `Terminação fora de centro (neck folgado no blank)

Ø diâmetro de gargalos (MO e/ou BL) fora do especificado

Raios de blanks desgastados.`,




    'Negativo': `Rebarba na região do fundo do molde

Marca de baffle acentuada

Tripé muito raso.`,




    'Equipamento fora de Centro': `O que é: Produto assimétrico ou com distribuição irregular de material.
Causas: Alinhamento incorreto do equipamento, desgaste de componentes, pressão desigual.
Solução: Realinhar equipamento, substituir componentes desgastados, verificar distribuição de pressão.`
  };
  
  defectText.value = defectInfoText[selected] || 'Informação não disponível para este defeito.';
});
      
      // Inicializa o Firebase
      initFirebase();
      
      // Aplica o idioma padrão
      applyLanguage(currentLang);
      
      console.log('Sistema inicializado com sucesso!');
    }

    // ===================================================================
    // INICIALIZAÇÃO FINAL DO SISTEMA
    // ===================================================================

    // Inicia o sistema quando o DOM estiver carregado
    document.addEventListener('DOMContentLoaded', init);

    // Fechamento do modal de imagem ao clicar fora
   document.getElementById('imageModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('imageModal')) {
        closeModal(document.getElementById('imageModal'));
      }
    });
  </script>
</body>
</html>
